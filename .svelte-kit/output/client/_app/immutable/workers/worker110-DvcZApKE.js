var Ie=Object.defineProperty;var qe=(t,n,e)=>n in t?Ie(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var ie=(t,n,e)=>qe(t,typeof n!="symbol"?n+"":n,e);function he(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function ge(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ce(t,n,e){return n&&ge(t.prototype,n),e&&ge(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Te=function(){function t(n){he(this,t),this.map=new Map,this.first=void 0,this.last=void 0,this.maxSize=n}return ce(t,[{key:"size",get:function(){return this.map.size}},{key:"get",value:function(e){var r=this.map.get(e);if(r!==void 0)return r!==this.first&&(r===this.last?(this.last=r.prev,this.last.next=void 0):(r.prev.next=r.next,r.next.prev=r.prev),r.next=this.first,this.first.prev=r,this.first=r),r.value}},{key:"set",value:function(e,r){if(!(this.maxSize<1)){if(this.map.has(e))throw new Error("Cannot update existing keys in the cache");var a=new Ee(e,r);for(this.first===void 0?(this.first=a,this.last=a):(a.next=this.first,this.first.prev=a,this.first=a),this.map.set(e,a);this.map.size>this.maxSize;){var i=this.last;this.map.delete(i.key),this.last=i.prev,this.last.next=void 0}}}}]),t}(),Ee=ce(function t(n,e){he(this,t),this.next=void 0,this.prev=void 0,this.key=n,this.value=e}),le=17,O=9e15,xe=Math.log10(9e15),Q=1/9e15,De=308,Fe=-324,ve=5,Ae=1023,Oe=function(){for(var t=[],n=Fe+1;n<=De;n++)t.push(+("1e"+n));var e=323;return function(r){return t[r+e]}}(),B=[2,Math.E,3,4,5,6,7,8,9,10],Ce=[[1,1.0891180521811203,1.1789767925673957,1.2701455431742086,1.3632090180450092,1.4587818160364217,1.5575237916251419,1.6601571006859253,1.767485818836978,1.8804192098842727,2],[1,1.1121114330934079,1.231038924931609,1.3583836963111375,1.4960519303993531,1.6463542337511945,1.8121385357018724,1.996971324618307,2.2053895545527546,2.4432574483385254,Math.E],[1,1.1187738849693603,1.2464963939368214,1.38527004705667,1.5376664685821402,1.7068895236551784,1.897001227148399,2.1132403089001035,2.362480153784171,2.6539010333870774,3],[1,1.1367350847096405,1.2889510672956703,1.4606478703324786,1.6570295196661111,1.8850062585672889,2.1539465047453485,2.476829779693097,2.872061932789197,3.3664204535587183,4],[1,1.1494592900767588,1.319708228183931,1.5166291280087583,1.748171114438024,2.0253263297298045,2.3636668498288547,2.7858359149579424,3.3257226212448145,4.035730287722532,5],[1,1.159225940787673,1.343712473580932,1.5611293155111927,1.8221199554561318,2.14183924486326,2.542468319282638,3.0574682501653316,3.7390572020926873,4.6719550537360774,6],[1,1.1670905356972596,1.3632807444991446,1.5979222279405536,1.8842640123816674,2.2416069644878687,2.69893426559423,3.3012632110403577,4.121250340630164,5.281493033448316,7],[1,1.1736630594087796,1.379783782386201,1.6292821855668218,1.9378971836180754,2.3289975651071977,2.8384347394720835,3.5232708454565906,4.478242031114584,5.868592169644505,8],[1,1.1793017514670474,1.394054150657457,1.65664127441059,1.985170999970283,2.4069682290577457,2.9647310119960752,3.7278665320924946,4.814462547283592,6.436522247411611,9],[1,1.1840100246247336,1.4061375836156955,1.6802272208863964,2.026757028388619,2.4770056063449646,3.080525271755482,3.9191964192627284,5.135152840833187,6.989961179534715,10]],Le=[[-1,-.9194161097107025,-.8335625019330468,-.7425599821143978,-.6466611521029437,-.5462617907227869,-.4419033816638769,-.3342645487554494,-.224140440909962,-.11241087890006762,0],[-1,-.90603157029014,-.80786507256596,-.7064666939634,-.60294836853664,-.49849837513117,-.39430303318768,-.29147201034755,-.19097820800866,-.09361896280296,0],[-1,-.9021579584316141,-.8005762598234203,-.6964780623319391,-.5911906810998454,-.486050182576545,-.3823089430815083,-.28106046722897615,-.1831906535795894,-.08935809204418144,0],[-1,-.8917227442365535,-.781258746326964,-.6705130326902455,-.5612813129406509,-.4551067709033134,-.35319256652135966,-.2563741554088552,-.1651412821106526,-.0796919581982668,0],[-1,-.8843387974366064,-.7678744063886243,-.6529563724510552,-.5415870994657841,-.4352842206588936,-.33504449124791424,-.24138853420685147,-.15445285440944467,-.07409659641336663,0],[-1,-.8786709358426346,-.7577735191184886,-.6399546189952064,-.527284921869926,-.4211627631006314,-.3223479611761232,-.23107655627789858,-.1472057700818259,-.07035171210706326,0],[-1,-.8740862815291583,-.7497032990976209,-.6297119746181752,-.5161838335958787,-.41036238255751956,-.31277212146489963,-.2233976621705518,-.1418697367979619,-.06762117662323441,0],[-1,-.8702632331800649,-.7430366914122081,-.6213373075161548,-.5072025698095242,-.40171437727184167,-.30517930701410456,-.21736343968190863,-.137710238299109,-.06550774483471955,0],[-1,-.8670016295947213,-.7373984232432306,-.6143173985094293,-.49973884395492807,-.394584953527678,-.2989649949848695,-.21245647317021688,-.13434688362382652,-.0638072667348083,0],[-1,-.8641642839543857,-.732534623168535,-.6083127477059322,-.4934049257184696,-.3885773075899922,-.29376029055315767,-.2083678561173622,-.13155653399373268,-.062401588652553186,0]],s=function(n){return f.fromValue_noAlloc(n)},v=function(n,e,r){return f.fromComponents(n,e,r)},y=function(n,e,r){return f.fromComponents_noNormalize(n,e,r)},J=function(n,e){var r=e+1,a=Math.ceil(Math.log10(Math.abs(n))),i=Math.round(n*Math.pow(10,r-a))*Math.pow(10,a-r);return parseFloat(i.toFixed(Math.max(r-a,0)))},oe=function(n){return Math.sign(n)*Math.log10(Math.abs(n))},Ke=function(n){if(!isFinite(n))return n;if(n<-50)return n===Math.trunc(n)?Number.NEGATIVE_INFINITY:0;for(var e=1;n<10;)e=e*n,++n;n-=1;var r=.9189385332046727;r=r+(n+.5)*Math.log(n),r=r-n;var a=n*n,i=n;return r=r+1/(12*i),i=i*a,r=r-1/(360*i),i=i*a,r=r+1/(1260*i),i=i*a,r=r-1/(1680*i),i=i*a,r=r+1/(1188*i),i=i*a,r=r-691/(360360*i),i=i*a,r=r+7/(1092*i),i=i*a,r=r-3617/(122400*i),Math.exp(r)/e},Pe=.36787944117144233,pe=.5671432904097838,fe=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-10,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a,i;if(!Number.isFinite(n))return n;if(r){if(n===0)return n;if(n===1)return pe;n<10?a=0:a=Math.log(n)-Math.log(Math.log(n))}else{if(n===0)return-1/0;n<=-.1?a=-2:a=Math.log(-n)-Math.log(-Math.log(-n))}for(var l=0;l<100;++l){if(i=(n*Math.exp(-a)+a*a)/(a+1),Math.abs(i-a)<e*Math.abs(i))return i;a=i}throw Error("Iteration failed to converge: ".concat(n.toString()))};function de(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e-10,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r,a,i,l;if(!Number.isFinite(t.mag))return new f(t);if(e){if(t.eq(f.dZero))return y(0,0,0);if(t.eq(f.dOne))return f.fromNumber(pe);r=f.ln(t)}else{if(t.eq(f.dZero))return new f(f.dNegInf);r=f.ln(t.neg())}for(var o=0;o<100;++o){if(a=r.neg().exp(),i=r.sub(t.mul(a)),l=r.sub(i.div(r.add(1).sub(r.add(2).mul(i).div(f.mul(2,r).add(2))))),f.abs(l.sub(r)).lt(f.abs(l).mul(n)))return l;r=l}throw Error("Iteration failed to converge: ".concat(t.toString()))}var f=function(){function t(n){he(this,t),this.sign=0,this.mag=0,this.layer=0,n instanceof t?this.fromDecimal(n):typeof n=="number"?this.fromNumber(n):typeof n=="string"&&this.fromString(n)}return ce(t,[{key:"m",get:function(){if(this.sign===0)return 0;if(this.layer===0){var e=Math.floor(Math.log10(this.mag)),r;return this.mag===5e-324?r=5:r=this.mag/Oe(e),this.sign*r}else if(this.layer===1){var a=this.mag-Math.floor(this.mag);return this.sign*Math.pow(10,a)}else return this.sign},set:function(e){this.layer<=2?this.fromMantissaExponent(e,this.e):(this.sign=Math.sign(e),this.sign===0&&(this.layer=0,this.exponent=0))}},{key:"e",get:function(){return this.sign===0?0:this.layer===0?Math.floor(Math.log10(this.mag)):this.layer===1?Math.floor(this.mag):this.layer===2?Math.floor(Math.sign(this.mag)*Math.pow(10,Math.abs(this.mag))):this.mag*Number.POSITIVE_INFINITY},set:function(e){this.fromMantissaExponent(this.m,e)}},{key:"s",get:function(){return this.sign},set:function(e){e===0?(this.sign=0,this.layer=0,this.mag=0):this.sign=e}},{key:"mantissa",get:function(){return this.m},set:function(e){this.m=e}},{key:"exponent",get:function(){return this.e},set:function(e){this.e=e}},{key:"normalize",value:function(){if(this.sign===0||this.mag===0&&this.layer===0||this.mag===Number.NEGATIVE_INFINITY&&this.layer>0&&Number.isFinite(this.layer))return this.sign=0,this.mag=0,this.layer=0,this;if(this.layer===0&&this.mag<0&&(this.mag=-this.mag,this.sign=-this.sign),this.mag===Number.POSITIVE_INFINITY||this.layer===Number.POSITIVE_INFINITY||this.mag===Number.NEGATIVE_INFINITY||this.layer===Number.NEGATIVE_INFINITY)return this.mag=Number.POSITIVE_INFINITY,this.layer=Number.POSITIVE_INFINITY,this;if(this.layer===0&&this.mag<Q)return this.layer+=1,this.mag=Math.log10(this.mag),this;var e=Math.abs(this.mag),r=Math.sign(this.mag);if(e>=O)return this.layer+=1,this.mag=r*Math.log10(e),this;for(;e<xe&&this.layer>0;)this.layer-=1,this.layer===0?this.mag=Math.pow(10,this.mag):(this.mag=r*Math.pow(10,e),e=Math.abs(this.mag),r=Math.sign(this.mag));return this.layer===0&&(this.mag<0?(this.mag=-this.mag,this.sign=-this.sign):this.mag===0&&(this.sign=0)),(Number.isNaN(this.sign)||Number.isNaN(this.layer)||Number.isNaN(this.mag))&&(this.sign=Number.NaN,this.layer=Number.NaN,this.mag=Number.NaN),this}},{key:"fromComponents",value:function(e,r,a){return this.sign=e,this.layer=r,this.mag=a,this.normalize(),this}},{key:"fromComponents_noNormalize",value:function(e,r,a){return this.sign=e,this.layer=r,this.mag=a,this}},{key:"fromMantissaExponent",value:function(e,r){return this.layer=1,this.sign=Math.sign(e),e=Math.abs(e),this.mag=r+Math.log10(e),this.normalize(),this}},{key:"fromMantissaExponent_noNormalize",value:function(e,r){return this.fromMantissaExponent(e,r),this}},{key:"fromDecimal",value:function(e){return this.sign=e.sign,this.layer=e.layer,this.mag=e.mag,this}},{key:"fromNumber",value:function(e){return this.mag=Math.abs(e),this.sign=Math.sign(e),this.layer=0,this.normalize(),this}},{key:"fromString",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=e,i=t.fromStringCache.get(a);if(i!==void 0)return this.fromDecimal(i);e=e.replace(",","");var l=e.split("^^^");if(l.length===2){var o=parseFloat(l[0]),h=parseFloat(l[1]),m=l[1].split(";"),d=1;if(m.length===2&&(d=parseFloat(m[1]),isFinite(d)||(d=1)),isFinite(o)&&isFinite(h)){var u=t.pentate(o,h,d,r);return this.sign=u.sign,this.layer=u.layer,this.mag=u.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}}var k=e.split("^^");if(k.length===2){var D=parseFloat(k[0]),M=parseFloat(k[1]),g=k[1].split(";"),E=1;if(g.length===2&&(E=parseFloat(g[1]),isFinite(E)||(E=1)),isFinite(D)&&isFinite(M)){var F=t.tetrate(D,M,E,r);return this.sign=F.sign,this.layer=F.layer,this.mag=F.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}}var w=e.split("^");if(w.length===2){var T=parseFloat(w[0]),I=parseFloat(w[1]);if(isFinite(T)&&isFinite(I)){var q=t.pow(T,I);return this.sign=q.sign,this.layer=q.layer,this.mag=q.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}}e=e.trim().toLowerCase();var S,b,N=e.split("pt");if(N.length===2){S=10;var L=!1;N[0][0]=="-"&&(L=!0,N[0]=N[0].slice(1)),b=parseFloat(N[0]),N[1]=N[1].replace("(",""),N[1]=N[1].replace(")","");var C=parseFloat(N[1]);if(isFinite(C)||(C=1),isFinite(S)&&isFinite(b)){var K=t.tetrate(S,b,C,r);return this.sign=K.sign,this.layer=K.layer,this.mag=K.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),L&&(this.sign*=-1),this}}if(N=e.split("p"),N.length===2){S=10;var V=!1;N[0][0]=="-"&&(V=!0,N[0]=N[0].slice(1)),b=parseFloat(N[0]),N[1]=N[1].replace("(",""),N[1]=N[1].replace(")","");var P=parseFloat(N[1]);if(isFinite(P)||(P=1),isFinite(S)&&isFinite(b)){var R=t.tetrate(S,b,P,r);return this.sign=R.sign,this.layer=R.layer,this.mag=R.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),V&&(this.sign*=-1),this}}if(N=e.split("f"),N.length===2){S=10;var x=!1;N[0][0]=="-"&&(x=!0,N[0]=N[0].slice(1)),N[0]=N[0].replace("(",""),N[0]=N[0].replace(")","");var Z=parseFloat(N[0]);if(N[1]=N[1].replace("(",""),N[1]=N[1].replace(")",""),b=parseFloat(N[1]),isFinite(Z)||(Z=1),isFinite(S)&&isFinite(b)){var $=t.tetrate(S,b,Z,r);return this.sign=$.sign,this.layer=$.layer,this.mag=$.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),x&&(this.sign*=-1),this}}var _=e.split("e"),U=_.length-1;if(U===0){var se=parseFloat(e);if(isFinite(se))return this.fromNumber(se),t.fromStringCache.size>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}else if(U===1){var z=parseFloat(e);if(isFinite(z)&&Math.abs(z)>1e-307)return this.fromNumber(z),t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}var W=e.split("e^");if(W.length===2){this.sign=1,W[0].charAt(0)=="-"&&(this.sign=-1);for(var ae="",Y=0;Y<W[1].length;++Y){var G=W[1].charCodeAt(Y);if(G>=43&&G<=57||G===101)ae+=W[1].charAt(Y);else{if(this.layer=parseFloat(ae),this.mag=parseFloat(W[1].substr(Y+1)),this.layer<0||this.layer%1!=0){var te=t.tetrate(10,this.layer,this.mag,r);this.sign=te.sign,this.layer=te.layer,this.mag=te.mag}return this.normalize(),t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}}}if(U<1)return this.sign=0,this.layer=0,this.mag=0,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this;var H=parseFloat(_[0]);if(H===0)return this.sign=0,this.layer=0,this.mag=0,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this;var X=parseFloat(_[_.length-1]);if(U>=2){var re=parseFloat(_[_.length-2]);isFinite(re)&&(X*=Math.sign(re),X+=oe(re))}if(!isFinite(H))this.sign=_[0]==="-"?-1:1,this.layer=U,this.mag=X;else if(U===1)this.sign=Math.sign(H),this.layer=1,this.mag=X+Math.log10(Math.abs(H));else if(this.sign=Math.sign(H),this.layer=U,U===2){var j=t.mul(v(1,2,X),s(H));return this.sign=j.sign,this.layer=j.layer,this.mag=j.mag,t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}else this.mag=X;return this.normalize(),t.fromStringCache.maxSize>=1&&t.fromStringCache.set(a,t.fromDecimal(this)),this}},{key:"fromValue",value:function(e){return e instanceof t?this.fromDecimal(e):typeof e=="number"?this.fromNumber(e):typeof e=="string"?this.fromString(e):(this.sign=0,this.layer=0,this.mag=0,this)}},{key:"toNumber",value:function(){return this.mag===Number.POSITIVE_INFINITY&&this.layer===Number.POSITIVE_INFINITY&&this.sign===1?Number.POSITIVE_INFINITY:this.mag===Number.POSITIVE_INFINITY&&this.layer===Number.POSITIVE_INFINITY&&this.sign===-1?Number.NEGATIVE_INFINITY:Number.isFinite(this.layer)?this.layer===0?this.sign*this.mag:this.layer===1?this.sign*Math.pow(10,this.mag):this.mag>0?this.sign>0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:0:Number.NaN}},{key:"mantissaWithDecimalPlaces",value:function(e){return isNaN(this.m)?Number.NaN:this.m===0?0:J(this.m,e)}},{key:"magnitudeWithDecimalPlaces",value:function(e){return isNaN(this.mag)?Number.NaN:this.mag===0?0:J(this.mag,e)}},{key:"toString",value:function(){return isNaN(this.layer)||isNaN(this.sign)||isNaN(this.mag)?"NaN":this.mag===Number.POSITIVE_INFINITY||this.layer===Number.POSITIVE_INFINITY?this.sign===1?"Infinity":"-Infinity":this.layer===0?this.mag<1e21&&this.mag>1e-7||this.mag===0?(this.sign*this.mag).toString():this.m+"e"+this.e:this.layer===1?this.m+"e"+this.e:this.layer<=ve?(this.sign===-1?"-":"")+"e".repeat(this.layer)+this.mag:(this.sign===-1?"-":"")+"(e^"+this.layer+")"+this.mag}},{key:"toExponential",value:function(e){return this.layer===0?(this.sign*this.mag).toExponential(e):this.toStringWithDecimalPlaces(e)}},{key:"toFixed",value:function(e){return this.layer===0?(this.sign*this.mag).toFixed(e):this.toStringWithDecimalPlaces(e)}},{key:"toPrecision",value:function(e){return this.e<=-7?this.toExponential(e-1):e>this.e?this.toFixed(e-this.exponent-1):this.toExponential(e-1)}},{key:"valueOf",value:function(){return this.toString()}},{key:"toJSON",value:function(){return this.toString()}},{key:"toStringWithDecimalPlaces",value:function(e){return this.layer===0?this.mag<1e21&&this.mag>1e-7||this.mag===0?(this.sign*this.mag).toFixed(e):J(this.m,e)+"e"+J(this.e,e):this.layer===1?J(this.m,e)+"e"+J(this.e,e):this.layer<=ve?(this.sign===-1?"-":"")+"e".repeat(this.layer)+J(this.mag,e):(this.sign===-1?"-":"")+"(e^"+this.layer+")"+J(this.mag,e)}},{key:"abs",value:function(){return y(this.sign===0?0:1,this.layer,this.mag)}},{key:"neg",value:function(){return y(-this.sign,this.layer,this.mag)}},{key:"negate",value:function(){return this.neg()}},{key:"negated",value:function(){return this.neg()}},{key:"sgn",value:function(){return this.sign}},{key:"round",value:function(){return this.mag<0?y(0,0,0):this.layer===0?v(this.sign,0,Math.round(this.mag)):new t(this)}},{key:"floor",value:function(){return this.mag<0?this.sign===-1?y(-1,0,1):y(0,0,0):this.sign===-1?this.neg().ceil().neg():this.layer===0?v(this.sign,0,Math.floor(this.mag)):new t(this)}},{key:"ceil",value:function(){return this.mag<0?this.sign===1?y(1,0,1):y(0,0,0):this.sign===-1?this.neg().floor().neg():this.layer===0?v(this.sign,0,Math.ceil(this.mag)):new t(this)}},{key:"trunc",value:function(){return this.mag<0?y(0,0,0):this.layer===0?v(this.sign,0,Math.trunc(this.mag)):new t(this)}},{key:"add",value:function(e){var r=s(e);if(this.eq(t.dInf)&&r.eq(t.dNegInf)||this.eq(t.dNegInf)&&r.eq(t.dInf))return new t(t.dNaN);if(!Number.isFinite(this.layer))return new t(this);if(!Number.isFinite(r.layer))return new t(r);if(this.sign===0)return new t(r);if(r.sign===0)return new t(this);if(this.sign===-r.sign&&this.layer===r.layer&&this.mag===r.mag)return y(0,0,0);var a,i;if(this.layer>=2||r.layer>=2)return this.maxabs(r);if(t.cmpabs(this,r)>0?(a=new t(this),i=new t(r)):(a=new t(r),i=new t(this)),a.layer===0&&i.layer===0)return t.fromNumber(a.sign*a.mag+i.sign*i.mag);var l=a.layer*Math.sign(a.mag),o=i.layer*Math.sign(i.mag);if(l-o>=2)return a;if(l===0&&o===-1){if(Math.abs(i.mag-Math.log10(a.mag))>le)return a;var h=Math.pow(10,Math.log10(a.mag)-i.mag),m=i.sign+a.sign*h;return v(Math.sign(m),1,i.mag+Math.log10(Math.abs(m)))}if(l===1&&o===0){if(Math.abs(a.mag-Math.log10(i.mag))>le)return a;var d=Math.pow(10,a.mag-Math.log10(i.mag)),u=i.sign+a.sign*d;return v(Math.sign(u),1,Math.log10(i.mag)+Math.log10(Math.abs(u)))}if(Math.abs(a.mag-i.mag)>le)return a;var k=Math.pow(10,a.mag-i.mag),D=i.sign+a.sign*k;return v(Math.sign(D),1,i.mag+Math.log10(Math.abs(D)))}},{key:"plus",value:function(e){return this.add(e)}},{key:"sub",value:function(e){return this.add(s(e).neg())}},{key:"subtract",value:function(e){return this.sub(e)}},{key:"minus",value:function(e){return this.sub(e)}},{key:"mul",value:function(e){var r=s(e);if(this.eq(t.dInf)&&r.eq(t.dNegInf)||this.eq(t.dNegInf)&&r.eq(t.dInf))return new t(t.dNegInf);if(this.mag==Number.POSITIVE_INFINITY&&r.eq(t.dZero)||this.eq(t.dZero)&&this.mag==Number.POSITIVE_INFINITY)return new t(t.dNaN);if(this.eq(t.dNegInf)&&r.eq(t.dNegInf))return new t(t.dInf);if(!Number.isFinite(this.layer))return new t(this);if(!Number.isFinite(r.layer))return new t(r);if(this.sign===0||r.sign===0)return y(0,0,0);if(this.layer===r.layer&&this.mag===-r.mag)return y(this.sign*r.sign,0,1);var a,i;if(this.layer>r.layer||this.layer==r.layer&&Math.abs(this.mag)>Math.abs(r.mag)?(a=new t(this),i=new t(r)):(a=new t(r),i=new t(this)),a.layer===0&&i.layer===0)return t.fromNumber(a.sign*i.sign*a.mag*i.mag);if(a.layer>=3||a.layer-i.layer>=2)return v(a.sign*i.sign,a.layer,a.mag);if(a.layer===1&&i.layer===0)return v(a.sign*i.sign,1,a.mag+Math.log10(i.mag));if(a.layer===1&&i.layer===1)return v(a.sign*i.sign,1,a.mag+i.mag);if(a.layer===2&&i.layer===1){var l=v(Math.sign(a.mag),a.layer-1,Math.abs(a.mag)).add(v(Math.sign(i.mag),i.layer-1,Math.abs(i.mag)));return v(a.sign*i.sign,l.layer+1,l.sign*l.mag)}if(a.layer===2&&i.layer===2){var o=v(Math.sign(a.mag),a.layer-1,Math.abs(a.mag)).add(v(Math.sign(i.mag),i.layer-1,Math.abs(i.mag)));return v(a.sign*i.sign,o.layer+1,o.sign*o.mag)}throw Error("Bad arguments to mul: "+this+", "+e)}},{key:"multiply",value:function(e){return this.mul(e)}},{key:"times",value:function(e){return this.mul(e)}},{key:"div",value:function(e){var r=s(e);return this.mul(r.recip())}},{key:"divide",value:function(e){return this.div(e)}},{key:"divideBy",value:function(e){return this.div(e)}},{key:"dividedBy",value:function(e){return this.div(e)}},{key:"recip",value:function(){return this.mag===0?new t(t.dNaN):this.mag===Number.POSITIVE_INFINITY?y(0,0,0):this.layer===0?v(this.sign,0,1/this.mag):v(this.sign,this.layer,-this.mag)}},{key:"reciprocal",value:function(){return this.recip()}},{key:"reciprocate",value:function(){return this.recip()}},{key:"mod",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=s(e),i=a.abs();if(this.eq(t.dZero)||i.eq(t.dZero))return y(0,0,0);if(r){var l=this.abs().mod(i);return this.sign==-1!=(a.sign==-1)&&(l=a.abs().sub(l)),l.mul(a.sign)}var o=this.toNumber(),h=i.toNumber();return isFinite(o)&&isFinite(h)&&o!=0&&h!=0?new t(o%h):this.sub(i).eq(this)?y(0,0,0):i.sub(this).eq(i)?new t(this):this.sign==-1?this.abs().mod(i).neg():this.sub(this.div(i).floor().mul(i))}},{key:"modulo",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.mod(e,r)}},{key:"modular",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return this.mod(e,r)}},{key:"cmp",value:function(e){var r=s(e);return this.sign>r.sign?1:this.sign<r.sign?-1:this.sign*this.cmpabs(e)}},{key:"cmpabs",value:function(e){var r=s(e),a=this.mag>0?this.layer:-this.layer,i=r.mag>0?r.layer:-r.layer;return a>i?1:a<i?-1:this.mag>r.mag?1:this.mag<r.mag?-1:0}},{key:"compare",value:function(e){return this.cmp(e)}},{key:"isNan",value:function(){return isNaN(this.sign)||isNaN(this.layer)||isNaN(this.mag)}},{key:"isFinite",value:function(n){function e(){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(){return isFinite(this.sign)&&isFinite(this.layer)&&isFinite(this.mag)})},{key:"eq",value:function(e){var r=s(e);return this.sign===r.sign&&this.layer===r.layer&&this.mag===r.mag}},{key:"equals",value:function(e){return this.eq(e)}},{key:"neq",value:function(e){return!this.eq(e)}},{key:"notEquals",value:function(e){return this.neq(e)}},{key:"lt",value:function(e){return this.cmp(e)===-1}},{key:"lte",value:function(e){return!this.gt(e)}},{key:"gt",value:function(e){return this.cmp(e)===1}},{key:"gte",value:function(e){return!this.lt(e)}},{key:"max",value:function(e){var r=s(e);return this.lt(r)?new t(r):new t(this)}},{key:"min",value:function(e){var r=s(e);return this.gt(r)?new t(r):new t(this)}},{key:"maxabs",value:function(e){var r=s(e);return this.cmpabs(r)<0?new t(r):new t(this)}},{key:"minabs",value:function(e){var r=s(e);return this.cmpabs(r)>0?new t(r):new t(this)}},{key:"clamp",value:function(e,r){return this.max(e).min(r)}},{key:"clampMin",value:function(e){return this.max(e)}},{key:"clampMax",value:function(e){return this.min(e)}},{key:"cmp_tolerance",value:function(e,r){var a=s(e);return this.eq_tolerance(a,r)?0:this.cmp(a)}},{key:"compare_tolerance",value:function(e,r){return this.cmp_tolerance(e,r)}},{key:"eq_tolerance",value:function(e,r){var a=s(e);if(r==null&&(r=1e-7),this.sign!==a.sign||Math.abs(this.layer-a.layer)>1)return!1;var i=this.mag,l=a.mag;return this.layer>a.layer&&(l=oe(l)),this.layer<a.layer&&(i=oe(i)),Math.abs(i-l)<=r*Math.max(Math.abs(i),Math.abs(l))}},{key:"equals_tolerance",value:function(e,r){return this.eq_tolerance(e,r)}},{key:"neq_tolerance",value:function(e,r){return!this.eq_tolerance(e,r)}},{key:"notEquals_tolerance",value:function(e,r){return this.neq_tolerance(e,r)}},{key:"lt_tolerance",value:function(e,r){var a=s(e);return!this.eq_tolerance(a,r)&&this.lt(a)}},{key:"lte_tolerance",value:function(e,r){var a=s(e);return this.eq_tolerance(a,r)||this.lt(a)}},{key:"gt_tolerance",value:function(e,r){var a=s(e);return!this.eq_tolerance(a,r)&&this.gt(a)}},{key:"gte_tolerance",value:function(e,r){var a=s(e);return this.eq_tolerance(a,r)||this.gt(a)}},{key:"pLog10",value:function(){return this.lt(t.dZero)?y(0,0,0):this.log10()}},{key:"absLog10",value:function(){return this.sign===0?new t(t.dNaN):this.layer>0?v(Math.sign(this.mag),this.layer-1,Math.abs(this.mag)):v(1,0,Math.log10(this.mag))}},{key:"log10",value:function(){return this.sign<=0?new t(t.dNaN):this.layer>0?v(Math.sign(this.mag),this.layer-1,Math.abs(this.mag)):v(this.sign,0,Math.log10(this.mag))}},{key:"log",value:function(e){return e=s(e),this.sign<=0?new t(t.dNaN):e.sign<=0?new t(t.dNaN):e.sign===1&&e.layer===0&&e.mag===1?new t(t.dNaN):this.layer===0&&e.layer===0?v(this.sign,0,Math.log(this.mag)/Math.log(e.mag)):t.div(this.log10(),e.log10())}},{key:"log2",value:function(){return this.sign<=0?new t(t.dNaN):this.layer===0?v(this.sign,0,Math.log2(this.mag)):this.layer===1?v(Math.sign(this.mag),0,Math.abs(this.mag)*3.321928094887362):this.layer===2?v(Math.sign(this.mag),1,Math.abs(this.mag)+.5213902276543247):v(Math.sign(this.mag),this.layer-1,Math.abs(this.mag))}},{key:"ln",value:function(){return this.sign<=0?new t(t.dNaN):this.layer===0?v(this.sign,0,Math.log(this.mag)):this.layer===1?v(Math.sign(this.mag),0,Math.abs(this.mag)*2.302585092994046):this.layer===2?v(Math.sign(this.mag),1,Math.abs(this.mag)+.36221568869946325):v(Math.sign(this.mag),this.layer-1,Math.abs(this.mag))}},{key:"logarithm",value:function(e){return this.log(e)}},{key:"pow",value:function(e){var r=s(e),a=new t(this),i=new t(r);if(a.sign===0)return i.eq(0)?y(1,0,1):a;if(a.sign===1&&a.layer===0&&a.mag===1)return a;if(i.sign===0)return y(1,0,1);if(i.sign===1&&i.layer===0&&i.mag===1)return a;var l=a.absLog10().mul(i).pow10();return this.sign===-1?Math.abs(i.toNumber()%2)%2===1?l.neg():Math.abs(i.toNumber()%2)%2===0?l:new t(t.dNaN):l}},{key:"pow10",value:function(){if(this.eq(t.dInf))return new t(t.dInf);if(this.eq(t.dNegInf))return y(0,0,0);if(!Number.isFinite(this.layer)||!Number.isFinite(this.mag))return new t(t.dNaN);var e=new t(this);if(e.layer===0){var r=Math.pow(10,e.sign*e.mag);if(Number.isFinite(r)&&Math.abs(r)>=.1)return v(1,0,r);if(e.sign===0)return y(1,0,1);e=y(e.sign,e.layer+1,Math.log10(e.mag))}return e.sign>0&&e.mag>=0?v(e.sign,e.layer+1,e.mag):e.sign<0&&e.mag>=0?v(-e.sign,e.layer+1,-e.mag):y(1,0,1)}},{key:"pow_base",value:function(e){return s(e).pow(this)}},{key:"root",value:function(e){var r=s(e);return this.lt(0)&&r.mod(2,!0).eq(1)?this.neg().root(r).neg():this.pow(r.recip())}},{key:"factorial",value:function(){return this.mag<0?this.add(1).gamma():this.layer===0?this.add(1).gamma():this.layer===1?t.exp(t.mul(this,t.ln(this).sub(1))):t.exp(this)}},{key:"gamma",value:function(){if(this.mag<0)return this.recip();if(this.layer===0){if(this.lt(y(1,0,24)))return t.fromNumber(Ke(this.sign*this.mag));var e=this.mag-1,r=.9189385332046727;r=r+(e+.5)*Math.log(e),r=r-e;var a=e*e,i=e,l=12*i,o=1/l,h=r+o;if(h===r||(r=h,i=i*a,l=360*i,o=1/l,h=r-o,h===r))return t.exp(r);r=h,i=i*a,l=1260*i;var m=1/l;return r=r+m,i=i*a,l=1680*i,m=1/l,r=r-m,t.exp(r)}else return this.layer===1?t.exp(t.mul(this,t.ln(this).sub(1))):t.exp(this)}},{key:"lngamma",value:function(){return this.gamma().ln()}},{key:"exp",value:function(){return this.mag<0?y(1,0,1):this.layer===0&&this.mag<=709.7?t.fromNumber(Math.exp(this.sign*this.mag)):this.layer===0?v(1,1,this.sign*Math.log10(Math.E)*this.mag):this.layer===1?v(1,2,this.sign*(Math.log10(.4342944819032518)+this.mag)):v(1,this.layer+1,this.sign*this.mag)}},{key:"sqr",value:function(){return this.pow(2)}},{key:"sqrt",value:function(){if(this.layer===0)return t.fromNumber(Math.sqrt(this.sign*this.mag));if(this.layer===1)return v(1,2,Math.log10(this.mag)-.3010299956639812);var e=t.div(y(this.sign,this.layer-1,this.mag),y(1,0,2));return e.layer+=1,e.normalize(),e}},{key:"cube",value:function(){return this.pow(3)}},{key:"cbrt",value:function(){return this.lt(0)?this.neg().pow(1/3).neg():this.pow(1/3)}},{key:"tetrate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y(1,0,1),a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e===1)return t.pow(this,r);if(e===0)return new t(r);if(this.eq(t.dOne))return y(1,0,1);if(this.eq(-1))return t.pow(this,r);if(e===Number.POSITIVE_INFINITY){var i=this.toNumber();if(i<=1.444667861009766&&i>=.06598803584531254){var l=t.ln(this).neg(),o=l.lambertw().div(l);if(i<1)return o;var h=l.lambertw(!1).div(l);return i>1.444667861009099&&(o=h=t.fromNumber(Math.E)),r=s(r),r.eq(h)?h:r.lt(h)?o:new t(t.dInf)}else return i>1.444667861009766?new t(t.dInf):new t(t.dNaN)}if(this.eq(t.dZero)){var m=Math.abs((e+1)%2);return m>1&&(m=2-m),t.fromNumber(m)}if(e<0)return t.iteratedlog(r,this,-e,a);r=new t(r);var d=e;e=Math.trunc(e);var u=d-e;if(this.gt(t.dZero)&&(this.lt(1)||this.lte(1.444667861009766)&&r.lte(t.ln(this).neg().lambertw(!1).div(t.ln(this).neg())))&&(d>1e4||!a)){var k=Math.min(1e4,e);r.eq(t.dOne)?r=this.pow(u):this.lt(1)?r=r.pow(1-u).mul(this.pow(r).pow(u)):r=r.layeradd(u,this);for(var D=0;D<k;++D){var M=r;if(r=this.pow(r),M.eq(r))return r}return d>1e4&&Math.ceil(d)%2==1?this.pow(r):r}u!==0&&(r.eq(t.dOne)?this.gt(10)||a?r=this.pow(u):(r=t.fromNumber(t.tetrate_critical(this.toNumber(),u)),this.lt(2)&&(r=r.sub(1).mul(this.minus(1)).plus(1))):this.eq(10)?r=r.layeradd10(u,a):this.lt(1)?r=r.pow(1-u).mul(this.pow(r).pow(u)):r=r.layeradd(u,this,a));for(var g=0;g<e;++g){if(r=this.pow(r),!isFinite(r.layer)||!isFinite(r.mag))return r.normalize();if(r.layer-this.layer>3)return y(r.sign,r.layer+(e-g-1),r.mag);if(g>1e4)return r}return r}},{key:"iteratedexp",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y(1,0,1),a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return this.tetrate(e,r,a)}},{key:"iteratedlog",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(r<0)return t.tetrate(e,-r,this,a);e=s(e);var i=t.fromDecimal(this),l=r;r=Math.trunc(r);var o=l-r;if(i.layer-e.layer>3){var h=Math.min(r,i.layer-e.layer-3);r-=h,i.layer-=h}for(var m=0;m<r;++m){if(i=i.log(e),!isFinite(i.layer)||!isFinite(i.mag))return i.normalize();if(m>1e4)return i}return o>0&&o<1&&(e.eq(10)?i=i.layeradd10(-o,a):i=i.layeradd(-o,e,a)),i}},{key:"slog",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=.001,l=!1,o=!1,h=this.slog_internal(e,a).toNumber(),m=1;m<r;++m){var d=new t(e).tetrate(h,t.dOne,a),u=d.gt(this);if(m>1&&o!=u&&(l=!0),o=u,l?i/=2:i*=2,i=Math.abs(i)*(u?-1:1),h+=i,i===0)break}return t.fromNumber(h)}},{key:"slog_internal",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e=s(e),e.lte(t.dZero))return new t(t.dNaN);if(e.eq(t.dOne))return new t(t.dNaN);if(e.lt(t.dOne))return this.eq(t.dOne)?y(0,0,0):this.eq(t.dZero)?y(-1,0,1):new t(t.dNaN);if(this.mag<0||this.eq(t.dZero))return y(-1,0,1);if(e.lt(1.444667861009766)){var a=t.ln(e).neg(),i=a.lambertw().div(a);if(this.eq(i))return new t(t.dInf);if(this.gt(i))return new t(t.dNaN)}var l=0,o=t.fromDecimal(this);if(o.layer-e.layer>3){var h=o.layer-e.layer-3;l+=h,o.layer-=h}for(var m=0;m<100;++m)if(o.lt(t.dZero))o=t.pow(e,o),l-=1;else{if(o.lte(t.dOne))return r?t.fromNumber(l+o.toNumber()-1):t.fromNumber(l+t.slog_critical(e.toNumber(),o.toNumber()));l+=1,o=t.log(o,e)}return t.fromNumber(l)}},{key:"layeradd10",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;e=t.fromValue_noAlloc(e).toNumber();var a=t.fromDecimal(this);if(e>=1){a.mag<0&&a.layer>0?(a.sign=0,a.mag=0,a.layer=0):a.sign===-1&&a.layer==0&&(a.sign=1,a.mag=-a.mag);var i=Math.trunc(e);e-=i,a.layer+=i}if(e<=-1){var l=Math.trunc(e);if(e-=l,a.layer+=l,a.layer<0)for(var o=0;o<100;++o){if(a.layer++,a.mag=Math.log10(a.mag),!isFinite(a.mag))return a.sign===0&&(a.sign=1),a.layer<0&&(a.layer=0),a.normalize();if(a.layer>=0)break}}for(;a.layer<0;)a.layer++,a.mag=Math.log10(a.mag);return a.sign===0&&(a.sign=1,a.mag===0&&a.layer>=1&&(a.layer-=1,a.mag=1)),a.normalize(),e!==0?a.layeradd(e,10,r):a}},{key:"layeradd",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=s(r);if(i.gt(1)&&i.lte(1.444667861009766)){var l=t.excess_slog(this,r,a),o=l[0].toNumber(),h=l[1],m=o+e,d=t.ln(r).neg(),u=d.lambertw().div(d),k=d.lambertw(!1).div(d),D=t.dOne;h==1?D=u.mul(k).sqrt():h==2&&(D=k.mul(2));var M=i.pow(D),g=Math.floor(m),E=m-g,F=D.pow(1-E).mul(M.pow(E));return t.tetrate(i,g,F,a)}var w=this.slog(r,100,a).toNumber(),T=w+e;return T>=0?t.tetrate(r,T,t.dOne,a):Number.isFinite(T)?T>=-1?t.log(t.tetrate(r,T+1,t.dOne,a),r):t.log(t.log(t.tetrate(r,T+2,t.dOne,a),r),r):new t(t.dNaN)}},{key:"lambertw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.lt(-.3678794411710499)?new t(t.dNaN):e?this.abs().lt("1e-300")?new t(this):this.mag<0?t.fromNumber(fe(this.toNumber())):this.layer===0?t.fromNumber(fe(this.sign*this.mag)):this.lt("eee15")?de(this):this.ln():this.sign===1?new t(t.dNaN):this.layer===0?t.fromNumber(fe(this.sign*this.mag,1e-10,!1)):this.layer==1?de(this,1e-10,!1):this.neg().recip().lambertw().neg()}},{key:"ssqrt",value:function(){return this.linear_sroot(2)}},{key:"linear_sroot",value:function(e){if(e==1)return this;if(this.eq(t.dInf))return new t(t.dInf);if(!this.isFinite())return new t(t.dNaN);if(e>0&&e<1)return this.root(e);if(e>-2&&e<-1)return t.fromNumber(e).add(2).pow(this.recip());if(e<=0)return new t(t.dNaN);if(e==Number.POSITIVE_INFINITY){var r=this.toNumber();return r<Math.E&&r>Pe?this.pow(this.recip()):new t(t.dNaN)}if(this.eq(1))return y(1,0,1);if(this.lt(0))return new t(t.dNaN);if(this.lte("1ee-16"))return e%2==1?new t(this):new t(t.dNaN);if(this.gt(1)){var a=t.dTen;this.gte(t.tetrate(10,e,1,!0))&&(a=this.iteratedlog(10,e-1,!0)),e<=1&&(a=this.root(e));for(var i=t.dZero,l=a.layer,o=a.iteratedlog(10,l,!0),h=o,m=o.div(2),d=!0;d;)m=i.add(o).div(2),t.iteratedexp(10,l,m,!0).tetrate(e,1,!0).gt(this)?o=m:i=m,m.eq(h)?d=!1:h=m;return t.iteratedexp(10,l,m,!0)}else{for(var u=1,k=v(1,10,1),D=v(1,10,1),M=v(1,10,1),g=v(1,1,-16),E=t.dZero,F=v(1,10,1),w=g.pow10().recip(),T=t.dZero,I=w,q=w,S=Math.ceil(e)%2==0,b=0,N=v(1,10,1),L=!1,C=t.dZero,K=!1;u<4;){if(u==2){if(S)break;M=v(1,10,1),g=k,u=3,F=v(1,10,1),N=v(1,10,1)}for(L=!1;g.neq(M);){if(C=g,g.pow10().recip().tetrate(e,1,!0).eq(1)&&g.pow10().recip().lt(.4))w=g.pow10().recip(),I=g.pow10().recip(),q=g.pow10().recip(),T=t.dZero,b=-1,u==3&&(N=g);else if(g.pow10().recip().tetrate(e,1,!0).eq(g.pow10().recip())&&!S&&g.pow10().recip().lt(.4))w=g.pow10().recip(),I=g.pow10().recip(),q=g.pow10().recip(),T=t.dZero,b=0;else if(g.pow10().recip().tetrate(e,1,!0).eq(g.pow10().recip().mul(2).tetrate(e,1,!0)))w=g.pow10().recip(),I=t.dZero,q=w.mul(2),T=w,S?b=-1:b=0;else{for(E=g.mul(12e-17),w=g.pow10().recip(),I=g.add(E).pow10().recip(),T=w.sub(I),q=w.add(T);I.tetrate(e,1,!0).eq(w.tetrate(e,1,!0))||q.tetrate(e,1,!0).eq(w.tetrate(e,1,!0))||I.gte(w)||q.lte(w);)E=E.mul(2),I=g.add(E).pow10().recip(),T=w.sub(I),q=w.add(T);if((u==1&&q.tetrate(e,1,!0).gt(w.tetrate(e,1,!0))&&I.tetrate(e,1,!0).gt(w.tetrate(e,1,!0))||u==3&&q.tetrate(e,1,!0).lt(w.tetrate(e,1,!0))&&I.tetrate(e,1,!0).lt(w.tetrate(e,1,!0)))&&(N=g),q.tetrate(e,1,!0).lt(w.tetrate(e,1,!0)))b=-1;else if(S)b=1;else if(u==3&&g.gt_tolerance(k,1e-8))b=0;else{for(;I.tetrate(e,1,!0).eq_tolerance(w.tetrate(e,1,!0),1e-8)||q.tetrate(e,1,!0).eq_tolerance(w.tetrate(e,1,!0),1e-8)||I.gte(w)||q.lte(w);)E=E.mul(2),I=g.add(E).pow10().recip(),T=w.sub(I),q=w.add(T);q.tetrate(e,1,!0).sub(w.tetrate(e,1,!0)).lt(w.tetrate(e,1,!0).sub(I.tetrate(e,1,!0)))?b=0:b=1}}if(b==-1&&(K=!0),u==1&&b==1||u==3&&b!=0)if(M.eq(v(1,10,1)))g=g.mul(2);else{var V=!1;if(L&&(b==1&&u==1||b==-1&&u==3)&&(V=!0),g=g.add(M).div(2),V)break}else if(M.eq(v(1,10,1)))M=g,g=g.div(2);else{var P=!1;if(L&&(b==1&&u==1||b==-1&&u==3)&&(P=!0),M=M.sub(F),g=g.sub(F),P)break}if(M.sub(g).div(2).abs().gt(F.mul(1.5))&&(L=!0),F=M.sub(g).div(2).abs(),g.gt("1e18")||g.eq(C))break}if(g.gt("1e18")||!K||N==v(1,10,1))break;u==1?k=N:u==3&&(D=N),u++}M=k,g=v(1,1,-18);for(var R=g,x=t.dZero,Z=!0;Z;)if(M.eq(v(1,10,1))?x=g.mul(2):x=M.add(g).div(2),t.pow(10,x).recip().tetrate(e,1,!0).gt(this)?g=x:M=x,x.eq(R)?Z=!1:R=x,g.gt("1e18"))return new t(t.dNaN);if(x.eq_tolerance(k,1e-15)){if(D.eq(v(1,10,1)))return new t(t.dNaN);for(M=v(1,10,1),g=D,R=g,x=t.dZero,Z=!0;Z;)if(M.eq(v(1,10,1))?x=g.mul(2):x=M.add(g).div(2),t.pow(10,x).recip().tetrate(e,1,!0).gt(this)?g=x:M=x,x.eq(R)?Z=!1:R=x,g.gt("1e18"))return new t(t.dNaN);return x.pow10().recip()}else return x.pow10().recip()}}},{key:"pentate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:y(1,0,1),a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;r=new t(r);var i=e;e=Math.floor(e);var l=i-e,o=t.dZero,h=t.dZero;if(l!==0)if(r.eq(t.dOne))++e,r=t.fromNumber(l);else return this.pentate(r.penta_log(this,void 0,a).plus(i).toNumber(),1,a);if(e>0)for(var m=0;m<e;){if(h=o,o=r,r=this.tetrate(r.toNumber(),t.dOne,a),++m,this.gt(0)&&this.lte(1)&&r.gt(0)&&r.lte(1))return this.tetrate(e-m,r,a);if(r.eq(o)||r.eq(h)&&m%2==e%2||!isFinite(r.layer)||!isFinite(r.mag))return r.normalize();if(m>1e4)return r}else for(var d=0;d<-e;++d){if(o=r,r=r.slog(this,void 0,a),r.eq(o)||!isFinite(r.layer)||!isFinite(r.mag))return r.normalize();if(d>100)return r}return r}},{key:"penta_log",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e=new t(e),e.lte(1))return new t(t.dNaN);if(this.eq(1))return y(0,0,0);if(this.eq(t.dInf))return new t(t.dInf);var i=new t(1),l=0,o=1;if(this.lt(-1)){if(this.lte(-2))return new t(t.dNaN);var h=e.tetrate(this.toNumber(),1,a);if(this.eq(h))return new t(t.dNegInf);if(this.gt(h))return new t(t.dNaN)}if(this.gt(1)){for(;i.lt(this);)if(l++,i=t.tetrate(e,i.toNumber(),1,a),l>1e3)return new t(t.dNaN)}else for(;i.gt(this);)if(l--,i=t.slog(i,e,a),l>100)return new t(t.dNaN);for(var m=1;m<r;++m){var d=e.pentate(l,t.dOne,a);if(d.eq(this))break;var u=d.gt(this);if(o=Math.abs(o)*(u?-1:1),l+=o,o/=2,o===0)break}return t.fromNumber(l)}},{key:"linear_penta_root",value:function(e){return e==1?this:e<0?new t(t.dNaN):this.eq(t.dInf)?new t(t.dInf):this.isFinite()?e>0&&e<1?this.root(e):this.eq(1)?y(1,0,1):this.lt(0)?new t(t.dNaN):this.lt(1)?this.linear_sroot(e):t.increasingInverse(function(r){return t.pentate(r,e,1,!0)})(this):new t(t.dNaN)}},{key:"sin",value:function(){return this.mag<0?new t(this):this.layer===0?t.fromNumber(Math.sin(this.sign*this.mag)):y(0,0,0)}},{key:"cos",value:function(){return this.mag<0?y(1,0,1):this.layer===0?t.fromNumber(Math.cos(this.sign*this.mag)):y(0,0,0)}},{key:"tan",value:function(){return this.mag<0?new t(this):this.layer===0?t.fromNumber(Math.tan(this.sign*this.mag)):y(0,0,0)}},{key:"asin",value:function(){return this.mag<0?new t(this):this.layer===0?t.fromNumber(Math.asin(this.sign*this.mag)):new t(t.dNaN)}},{key:"acos",value:function(){return this.mag<0?t.fromNumber(Math.acos(this.toNumber())):this.layer===0?t.fromNumber(Math.acos(this.sign*this.mag)):new t(t.dNaN)}},{key:"atan",value:function(){return this.mag<0?new t(this):this.layer===0?t.fromNumber(Math.atan(this.sign*this.mag)):t.fromNumber(Math.atan(this.sign*(1/0)))}},{key:"sinh",value:function(){return this.exp().sub(this.negate().exp()).div(2)}},{key:"cosh",value:function(){return this.exp().add(this.negate().exp()).div(2)}},{key:"tanh",value:function(){return this.sinh().div(this.cosh())}},{key:"asinh",value:function(){return t.ln(this.add(this.sqr().add(1).sqrt()))}},{key:"acosh",value:function(){return t.ln(this.add(this.sqr().sub(1).sqrt()))}},{key:"atanh",value:function(){return this.abs().gte(1)?new t(t.dNaN):t.ln(this.add(1).div(t.fromNumber(1).sub(this))).div(2)}},{key:"ascensionPenalty",value:function(e){return e===0?new t(this):this.root(t.pow(10,e))}},{key:"egg",value:function(){return this.add(9)}},{key:"lessThanOrEqualTo",value:function(e){return this.cmp(e)<1}},{key:"lessThan",value:function(e){return this.cmp(e)<0}},{key:"greaterThanOrEqualTo",value:function(e){return this.cmp(e)>-1}},{key:"greaterThan",value:function(e){return this.cmp(e)>0}}],[{key:"fromComponents",value:function(e,r,a){return new t().fromComponents(e,r,a)}},{key:"fromComponents_noNormalize",value:function(e,r,a){return new t().fromComponents_noNormalize(e,r,a)}},{key:"fromMantissaExponent",value:function(e,r){return new t().fromMantissaExponent(e,r)}},{key:"fromMantissaExponent_noNormalize",value:function(e,r){return new t().fromMantissaExponent_noNormalize(e,r)}},{key:"fromDecimal",value:function(e){return new t().fromDecimal(e)}},{key:"fromNumber",value:function(e){return new t().fromNumber(e)}},{key:"fromString",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new t().fromString(e,r)}},{key:"fromValue",value:function(e){return new t().fromValue(e)}},{key:"fromValue_noAlloc",value:function(e){if(e instanceof t)return e;if(typeof e=="string"){var r=t.fromStringCache.get(e);return r!==void 0?r:t.fromString(e)}else return typeof e=="number"?t.fromNumber(e):y(0,0,0)}},{key:"abs",value:function(e){return s(e).abs()}},{key:"neg",value:function(e){return s(e).neg()}},{key:"negate",value:function(e){return s(e).neg()}},{key:"negated",value:function(e){return s(e).neg()}},{key:"sign",value:function(e){return s(e).sign}},{key:"sgn",value:function(e){return s(e).sign}},{key:"round",value:function(e){return s(e).round()}},{key:"floor",value:function(e){return s(e).floor()}},{key:"ceil",value:function(e){return s(e).ceil()}},{key:"trunc",value:function(e){return s(e).trunc()}},{key:"add",value:function(e,r){return s(e).add(r)}},{key:"plus",value:function(e,r){return s(e).add(r)}},{key:"sub",value:function(e,r){return s(e).sub(r)}},{key:"subtract",value:function(e,r){return s(e).sub(r)}},{key:"minus",value:function(e,r){return s(e).sub(r)}},{key:"mul",value:function(e,r){return s(e).mul(r)}},{key:"multiply",value:function(e,r){return s(e).mul(r)}},{key:"times",value:function(e,r){return s(e).mul(r)}},{key:"div",value:function(e,r){return s(e).div(r)}},{key:"divide",value:function(e,r){return s(e).div(r)}},{key:"recip",value:function(e){return s(e).recip()}},{key:"reciprocal",value:function(e){return s(e).recip()}},{key:"reciprocate",value:function(e){return s(e).reciprocate()}},{key:"mod",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).mod(r,a)}},{key:"modulo",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).modulo(r,a)}},{key:"modular",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).modular(r,a)}},{key:"cmp",value:function(e,r){return s(e).cmp(r)}},{key:"cmpabs",value:function(e,r){return s(e).cmpabs(r)}},{key:"compare",value:function(e,r){return s(e).cmp(r)}},{key:"isNaN",value:function(n){function e(r){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return n=s(n),isNaN(n.sign)||isNaN(n.layer)||isNaN(n.mag)})},{key:"isFinite",value:function(n){function e(r){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return n=s(n),isFinite(n.sign)&&isFinite(n.layer)&&isFinite(n.mag)})},{key:"eq",value:function(e,r){return s(e).eq(r)}},{key:"equals",value:function(e,r){return s(e).eq(r)}},{key:"neq",value:function(e,r){return s(e).neq(r)}},{key:"notEquals",value:function(e,r){return s(e).notEquals(r)}},{key:"lt",value:function(e,r){return s(e).lt(r)}},{key:"lte",value:function(e,r){return s(e).lte(r)}},{key:"gt",value:function(e,r){return s(e).gt(r)}},{key:"gte",value:function(e,r){return s(e).gte(r)}},{key:"max",value:function(e,r){return s(e).max(r)}},{key:"min",value:function(e,r){return s(e).min(r)}},{key:"minabs",value:function(e,r){return s(e).minabs(r)}},{key:"maxabs",value:function(e,r){return s(e).maxabs(r)}},{key:"clamp",value:function(e,r,a){return s(e).clamp(r,a)}},{key:"clampMin",value:function(e,r){return s(e).clampMin(r)}},{key:"clampMax",value:function(e,r){return s(e).clampMax(r)}},{key:"cmp_tolerance",value:function(e,r,a){return s(e).cmp_tolerance(r,a)}},{key:"compare_tolerance",value:function(e,r,a){return s(e).cmp_tolerance(r,a)}},{key:"eq_tolerance",value:function(e,r,a){return s(e).eq_tolerance(r,a)}},{key:"equals_tolerance",value:function(e,r,a){return s(e).eq_tolerance(r,a)}},{key:"neq_tolerance",value:function(e,r,a){return s(e).neq_tolerance(r,a)}},{key:"notEquals_tolerance",value:function(e,r,a){return s(e).notEquals_tolerance(r,a)}},{key:"lt_tolerance",value:function(e,r,a){return s(e).lt_tolerance(r,a)}},{key:"lte_tolerance",value:function(e,r,a){return s(e).lte_tolerance(r,a)}},{key:"gt_tolerance",value:function(e,r,a){return s(e).gt_tolerance(r,a)}},{key:"gte_tolerance",value:function(e,r,a){return s(e).gte_tolerance(r,a)}},{key:"pLog10",value:function(e){return s(e).pLog10()}},{key:"absLog10",value:function(e){return s(e).absLog10()}},{key:"log10",value:function(e){return s(e).log10()}},{key:"log",value:function(e,r){return s(e).log(r)}},{key:"log2",value:function(e){return s(e).log2()}},{key:"ln",value:function(e){return s(e).ln()}},{key:"logarithm",value:function(e,r){return s(e).logarithm(r)}},{key:"pow",value:function(e,r){return s(e).pow(r)}},{key:"pow10",value:function(e){return s(e).pow10()}},{key:"root",value:function(e,r){return s(e).root(r)}},{key:"factorial",value:function(e,r){return s(e).factorial()}},{key:"gamma",value:function(e,r){return s(e).gamma()}},{key:"lngamma",value:function(e,r){return s(e).lngamma()}},{key:"exp",value:function(e){return s(e).exp()}},{key:"sqr",value:function(e){return s(e).sqr()}},{key:"sqrt",value:function(e){return s(e).sqrt()}},{key:"cube",value:function(e){return s(e).cube()}},{key:"cbrt",value:function(e){return s(e).cbrt()}},{key:"tetrate",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y(1,0,1),i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return s(e).tetrate(r,a,i)}},{key:"iteratedexp",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y(1,0,1),i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return s(e).iteratedexp(r,a,i)}},{key:"iteratedlog",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return s(e).iteratedlog(r,a,i)}},{key:"layeradd10",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).layeradd10(r,a)}},{key:"layeradd",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return s(e).layeradd(r,a,i)}},{key:"slog",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).slog(r,100,a)}},{key:"lambertw",value:function(e,r){return s(e).lambertw(r)}},{key:"ssqrt",value:function(e){return s(e).ssqrt()}},{key:"linear_sroot",value:function(e,r){return s(e).linear_sroot(r)}},{key:"pentate",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y(1,0,1),i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return s(e).pentate(r,a,i)}},{key:"penta_log",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return s(e).penta_log(r,100,a)}},{key:"linear_penta_root",value:function(e,r){return s(e).linear_penta_root(r)}},{key:"sin",value:function(e){return s(e).sin()}},{key:"cos",value:function(e){return s(e).cos()}},{key:"tan",value:function(e){return s(e).tan()}},{key:"asin",value:function(e){return s(e).asin()}},{key:"acos",value:function(e){return s(e).acos()}},{key:"atan",value:function(e){return s(e).atan()}},{key:"sinh",value:function(e){return s(e).sinh()}},{key:"cosh",value:function(e){return s(e).cosh()}},{key:"tanh",value:function(e){return s(e).tanh()}},{key:"asinh",value:function(e){return s(e).asinh()}},{key:"acosh",value:function(e){return s(e).acosh()}},{key:"atanh",value:function(e){return s(e).atanh()}},{key:"affordGeometricSeries",value:function(e,r,a,i){return this.affordGeometricSeries_core(s(e),s(r),s(a),i)}},{key:"sumGeometricSeries",value:function(e,r,a,i){return this.sumGeometricSeries_core(e,s(r),s(a),i)}},{key:"affordArithmeticSeries",value:function(e,r,a,i){return this.affordArithmeticSeries_core(s(e),s(r),s(a),s(i))}},{key:"sumArithmeticSeries",value:function(e,r,a,i){return this.sumArithmeticSeries_core(s(e),s(r),s(a),s(i))}},{key:"efficiencyOfPurchase",value:function(e,r,a){return this.efficiencyOfPurchase_core(s(e),s(r),s(a))}},{key:"randomDecimalForTesting",value:function(e){if(Math.random()*20<1)return y(0,0,0);var r=Math.random()>.5?1:-1;if(Math.random()*20<1)return y(r,0,1);var a=Math.floor(Math.random()*(e+1)),i=a===0?Math.random()*616-308:Math.random()*16;Math.random()>.9&&(i=Math.trunc(i));var l=Math.pow(10,i);return Math.random()>.9&&(l=Math.trunc(l)),v(r,a,l)}},{key:"affordGeometricSeries_core",value:function(e,r,a,i){var l=r.mul(a.pow(i));return t.floor(e.div(l).mul(a.sub(1)).add(1).log10().div(a.log10()))}},{key:"sumGeometricSeries_core",value:function(e,r,a,i){return r.mul(a.pow(i)).mul(t.sub(1,a.pow(e))).div(t.sub(1,a))}},{key:"affordArithmeticSeries_core",value:function(e,r,a,i){var l=r.add(i.mul(a)),o=l.sub(a.div(2)),h=o.pow(2);return o.neg().add(h.add(a.mul(e).mul(2)).sqrt()).div(a).floor()}},{key:"sumArithmeticSeries_core",value:function(e,r,a,i){var l=r.add(i.mul(a));return e.div(2).mul(l.mul(2).plus(e.sub(1).mul(a)))}},{key:"efficiencyOfPurchase_core",value:function(e,r,a){return e.div(r).add(e.div(a))}},{key:"slog_critical",value:function(e,r){return e>10?r-1:t.critical_section(e,r,Le)}},{key:"tetrate_critical",value:function(e,r){return t.critical_section(e,r,Ce)}},{key:"critical_section",value:function(e,r,a){r*=10,r<0&&(r=0),r>10&&(r=10),e<2&&(e=2),e>10&&(e=10);for(var i=0,l=0,o=0;o<B.length;++o)if(B[o]==e){i=a[o][Math.floor(r)],l=a[o][Math.ceil(r)];break}else if(B[o]<e&&B[o+1]>e){var h=(e-B[o])/(B[o+1]-B[o]);i=a[o][Math.floor(r)]*(1-h)+a[o+1][Math.floor(r)]*h,l=a[o][Math.ceil(r)]*(1-h)+a[o+1][Math.ceil(r)]*h;break}var m=r-Math.floor(r);return i<=0||l<=0?i*(1-m)+l*m:Math.pow(e,Math.log(i)/Math.log(e)*(1-m)+Math.log(l)/Math.log(e)*m)}},{key:"excess_slog",value:function(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e=s(e),r=s(r);var i=r;if(r=r.toNumber(),r==1||r<=0)return[new t(t.dNaN),0];if(r>1.444667861009766)return[e.slog(r,100,a),0];var l=t.ln(r).neg(),o=l.lambertw().div(l),h=t.dInf;if(r>1&&(h=l.lambertw(!1).div(l)),r>1.444667861009099&&(o=h=t.fromNumber(Math.E)),e.lt(o))return[e.slog(r,100,a),0];if(e.eq(o))return[new t(t.dInf),0];if(e.eq(h))return[new t(t.dNegInf),2];if(e.gt(h)){var m=h.mul(2),d=i.pow(m),u=0;if(e.gte(m)&&e.lt(d))u=0;else if(e.gte(d)){var k=d;for(u=1;k.lt(e);)if(k=i.pow(k),u=u+1,k.layer>3){var D=Math.floor(e.layer-k.layer+1);k=i.iteratedexp(D,k,a),u=u+D}k.gt(e)&&(k=k.log(r),u=u-1)}else if(e.lt(m)){var M=m;for(u=0;M.gt(e);)M=M.log(r),u=u-1}for(var g=0,E=0,F=.5,w=m,T=t.dZero;F>1e-16;){if(E=g+F,w=m.pow(1-E).mul(d.pow(E)),T=t.iteratedexp(r,u,w),T.eq(e))return[new t(u+E),2];T.lt(e)&&(g+=F),F/=2}return T.neq_tolerance(e,1e-7)?[new t(t.dNaN),0]:[new t(u+g),2]}if(e.lt(h)&&e.gt(o)){var I=o.mul(h).sqrt(),q=i.pow(I),S=0;if(e.lte(I)&&e.gt(q))S=0;else if(e.lte(q)){var b=q;for(S=1;b.gt(e);)b=i.pow(b),S=S+1;b.lt(e)&&(b=b.log(r),S=S-1)}else if(e.gt(I)){var N=I;for(S=0;N.lt(e);)N=N.log(r),S=S-1}for(var L=0,C=0,K=.5,V=I,P=t.dZero;K>1e-16;){if(C=L+K,V=I.pow(1-C).mul(q.pow(C)),P=t.iteratedexp(r,S,V),P.eq(e))return[new t(S+C),1];P.gt(e)&&(L+=K),K/=2}return P.neq_tolerance(e,1e-7)?[new t(t.dNaN),0]:[new t(S+L),1]}throw new Error("Unhandled behavior in excess_slog")}},{key:"increasingInverse",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:120,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t.dLayerMax.neg(),l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:t.dLayerMax,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t.dLayerMax.neg(),h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:t.dLayerMax;return function(m){if(m=new t(m),i=new t(i),l=new t(l),o=new t(o),h=new t(h),m.isNan()||l.lt(i)||m.lt(o)||m.gt(h))return new t(t.dNaN);var d=function(p){return new t(p)},u=!0;if(l.lt(0))u=!1;else if(i.gt(0))u=!0;else{var k=e(t.dZero);if(k.eq(m))return y(0,0,0);u=m.gt(k),r&&(u=!u)}var D=u,M;if(u){if(l.lt(Q))u=!0;else if(i.gt(Q))u=!1;else{var g=e(new t(Q));u=m.lt(g),r&&(u=!u)}if(u){M=!0;var E=t.pow(10,O).recip();if(l.lt(E))u=!1;else if(i.gt(E))u=!0;else{var F=e(new t(E));u=m.gt(F),r&&(u=!u)}if(u)d=function(p){return t.pow(10,p).recip()};else{var w=t.tetrate(10,O);if(l.lt(w))u=!1;else if(i.gt(w))u=!0;else{var T=e(new t(w));u=m.gt(T),r&&(u=!u)}u?d=function(p){return t.tetrate(10,new t(p).toNumber()).recip()}:d=function(p){return new t(p).gt(Math.log10(Number.MAX_VALUE))?t.dZero:t.tetrate(10,t.pow(10,p).toNumber()).recip()}}}else{if(M=!1,l.lt(O))u=!0;else if(i.gt(O))u=!1;else{var I=e(new t(O));u=m.lt(I),r&&(u=!u)}if(u)d=function(p){return new t(p)};else{var q=t.pow(10,O);if(l.lt(q))u=!0;else if(i.gt(q))u=!1;else{var S=e(new t(q));u=m.lt(S),r&&(u=!u)}if(u)d=function(p){return t.pow(10,p)};else{var b=t.tetrate(10,O);if(l.lt(b))u=!0;else if(i.gt(b))u=!1;else{var N=e(new t(b));u=m.lt(N),r&&(u=!u)}u?d=function(p){return t.tetrate(10,new t(p).toNumber())}:d=function(p){return new t(p).gt(Math.log10(Number.MAX_VALUE))?t.dInf:t.tetrate(10,t.pow(10,p).toNumber())}}}}}else{if(M=!0,l.lt(-Q))u=!1;else if(i.gt(-Q))u=!0;else{var L=e(new t(-Q));u=m.gt(L),r&&(u=!u)}if(u){var C=t.pow(10,O).recip().neg();if(l.lt(C))u=!0;else if(i.gt(C))u=!1;else{var K=e(new t(C));u=m.lt(K),r&&(u=!u)}if(u)d=function(p){return t.pow(10,p).recip().neg()};else{var V=t.tetrate(10,O).neg();if(l.lt(V))u=!0;else if(i.gt(V))u=!1;else{var P=e(new t(V));u=m.lt(P),r&&(u=!u)}u?d=function(p){return t.tetrate(10,new t(p).toNumber()).recip().neg()}:d=function(p){return new t(p).gt(Math.log10(Number.MAX_VALUE))?t.dZero:t.tetrate(10,t.pow(10,p).toNumber()).recip().neg()}}}else{if(M=!1,l.lt(-O))u=!1;else if(i.gt(-O))u=!0;else{var R=e(new t(-O));u=m.gt(R),r&&(u=!u)}if(u)d=function(p){return t.neg(p)};else{var x=t.pow(10,O).neg();if(l.lt(x))u=!1;else if(i.gt(x))u=!0;else{var Z=e(new t(x));u=m.gt(Z),r&&(u=!u)}if(u)d=function(p){return t.pow(10,p).neg()};else{var $=t.tetrate(10,O).neg();if(l.lt($))u=!1;else if(i.gt($))u=!0;else{var _=e(new t($));u=m.gt(_),r&&(u=!u)}u?d=function(p){return t.tetrate(10,new t(p).toNumber()).neg()}:d=function(p){return new t(p).gt(Math.log10(Number.MAX_VALUE))?t.dNegInf:t.tetrate(10,t.pow(10,p).toNumber()).neg()}}}}}for(var U=D!=M!=r,se=U?function(A,p){return t.gt(A,p)}:function(A,p){return t.lt(A,p)},z=.001,W=!1,ae=!1,Y=1,G=t.dOne,te=0,H=!1,X=1;X<a;++X){H=!1,te=Y,G=d(Y),G.gt(l)&&(G=l,H=!0),G.lt(i)&&(G=i,H=!0);var re=e(G);if(re.eq(m)&&!H)break;var j=se(re,m);if(X>1&&ae!=j&&(W=!0),ae=j,W?z/=2:z*=2,j!=U&&G.eq(l)||j==U&&G.eq(i))return new t(t.dNaN);if(z=Math.abs(z)*(j?-1:1),Y+=z,z===0||te==Y)break}return d(Y)}}}]),t}();f.dZero=y(0,0,0);f.dOne=y(1,0,1);f.dNegOne=y(-1,0,1);f.dTwo=y(1,0,2);f.dTen=y(1,0,10);f.dNaN=y(Number.NaN,Number.NaN,Number.NaN);f.dInf=y(1,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);f.dNegInf=y(-1,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);f.dNumberMax=v(1,0,Number.MAX_VALUE);f.dNumberMin=v(1,0,Number.MIN_VALUE);f.dLayerSafeMax=v(1,Number.MAX_SAFE_INTEGER,O-1);f.dLayerSafeMin=v(1,Number.MAX_SAFE_INTEGER,-8999999999999999);f.dLayerMax=v(1,Number.MAX_VALUE,O-1);f.dLayerMin=v(1,Number.MAX_VALUE,-8999999999999999);f.fromStringCache=new Te(Ae);s=f.fromValue_noAlloc;v=f.fromComponents;y=f.fromComponents_noNormalize;f.fromMantissaExponent;f.fromMantissaExponent_noNormalize;function Ve(){return{saveVersion:110,currencies:{arcana:new f(1e3).toString(),forgegold:new f(0).toString(),dragonscales:new f(0).toString(),gems:new f(0).toString()},runTotalDistanceKm:new f(0).toString(),lifetimeTotalDistanceKm:new f(0).toString(),lifetimeMaxTotalDistanceKm:new f(0).toString(),currentLevel:1,levelDistanceKm:new f(0).toString(),enchants:{firepower:{level:0,tierUnlocked:1},scales:{level:0,tierUnlocked:1}},dragonHp:100,dragonMaxHp:100,travelState:"HOVERING",lastSaveTimestampMs:new f(Date.now()).toString(),ewma:{arcana:new f(0).toString(),alpha:new f(.2).toString()},notation:"scientific-ee@e100",debugMode:!1}}function Ue(t,n){const e=t.alpha,r=new f(1).minus(e);t.arcanaPerSec=e.mul(n).plus(r.mul(t.arcanaPerSec)),t.samples++}function Ge(t){const n=new f(Date.now()),e=new f(t.lastSaveTimestampMs),r=n.minus(e);if(r.lte(0))return{elapsedMs:new f(0),appliedMs:new f(0),arcanaGain:new f(0),wasOffline:!1};const a=new f(24*60*60*1e3),i=f.min(r,a),l=i.div(1e3),h=new f(t.ewma.arcana).mul(l);return{elapsedMs:r,appliedMs:i,arcanaGain:h,wasOffline:r.gt(3e4)}}function Re(t,n){if(n.arcanaGain.gt(0)){const e=new f(t.currencies.arcana);t.currencies.arcana=e.plus(n.arcanaGain).toString()}}let ee=null,ye=!1;async function Ze(){try{const t=await fetch("/distance-config.json");if(!t.ok)throw new Error(`Failed to load distance config: ${t.status}`);const n=await t.json();ee=Ne(n),ye=!0}catch(t){console.error("Failed to initialize level system:",t),ee=Ne({levelBaseKm:1.5,levelGrowth:1.25,maxLevels:2e3,overrides:{1:1.5,2:1.9,10:8}}),ye=!0}}function Ne(t){const{levelBaseKm:n,levelGrowth:e,maxLevels:r,overrides:a}=t,i=[new f(0)],l=[new f(0)];let o=new f(0);for(let h=1;h<=r;h++){const m=a[h.toString()];let d;if(m!==void 0)d=new f(m);else{const u=h-1;d=new f(n).mul(f.pow(e,u))}i[h]=d,o=o.plus(d),l[h]=o}return{requiredKm:i,cumulativeKm:l,maxLevels:r}}function me(t){if(!ee)throw new Error("Level system not initialized - call initializeLevelSystem() first");const{cumulativeKm:n,maxLevels:e}=ee;if(t.lte(0))return 1;let r=1,a=e;for(;r<a;){const i=Math.floor((r+a)/2);t.lt(n[i])?a=i:r=i+1}return Math.min(r,e)}function Ye(t){if(!ee)return 0;const n=me(t),{requiredKm:e,cumulativeKm:r}=ee;if(n>=ee.maxLevels)return 1;const a=n>1?r[n-1]:new f(0),i=e[n],l=t.minus(a);return Math.min(1,Math.max(0,l.div(i).toNumber()))}const He={firepower:new f(10),scales:new f(12)};function Me(t,n){if(n>=500)return new f(1/0);const e=He[t],a=n+1-1;return e.mul(f.pow(1.4,a)).ceil()}function ke(t){switch(t){case 1:return[0,50];case 2:return[51,200];case 3:return[201,500]}}function Se(t,n){if(n>=3)return new f(1/0);const[,e]=ke(n);return Me(t,e-1).mul(3)}function ze(t,n,e){if(t.tierUnlocked>=3)return!1;const[,r]=ke(t.tierUnlocked);if(t.level<r)return!1;const a=Se(e,t.tierUnlocked);return n.gte(a)}function Xe(t,n,e){if(t.level>=500)return{success:!1,newArcana:n};const r=Me(e,t.level);return n.gte(r)?{success:!0,newArcana:n.minus(r),cost:r}:{success:!1,newArcana:n}}function _e(t,n,e){if(!ze(t,n,e))return{success:!1,newArcana:n};const r=Se(e,t.tierUnlocked);return{success:!0,newArcana:n.minus(r),cost:r}}class We{constructor(){ie(this,"buffer",[]);ie(this,"maxLines",5e3);ie(this,"lastRateSampleTime",0);ie(this,"rateSampleInterval",1e4)}addEvent(n){const e=JSON.stringify(n);this.buffer.push(e),this.buffer.length>this.maxLines&&this.buffer.shift(),this.persistBuffer()}logPurchase(n,e,r,a,i){this.addEvent({timestamp:Date.now(),event:"purchase",enchant:n,fromLevel:e,toLevel:r,costStr:a.toString(),arcanaAfterStr:i.toString()})}logTierUp(n,e,r,a){this.addEvent({timestamp:Date.now(),event:"tierUp",enchant:n,fromTier:e,costStr:r.toString(),arcanaAfterStr:a.toString()})}logOfflinePayout(n,e,r){this.addEvent({timestamp:Date.now(),event:"offlinePayout",elapsedSec:n.toString(),arcanaRateStr:e.toString(),arcanaGainStr:r.toString()})}logResetJourney(n,e){this.addEvent({timestamp:Date.now(),event:"resetJourney",runTotalDistanceKmStr:n.toString(),lifetimeTotalsStr:e.toString()})}logFormatBoundary(n,e,r){this.addEvent({timestamp:Date.now(),event:"formatBoundary",fromNotation:n,toNotation:e,valueStr:r.toString()})}logRateSample(n){const e=Date.now();e-this.lastRateSampleTime<this.rateSampleInterval||(this.lastRateSampleTime=e,this.addEvent({timestamp:e,event:"rateSamples",ewmaArcanaPerSecStr:n.toString()}))}logEnemySpawn(n,e,r,a){this.addEvent({timestamp:Date.now(),event:"enemySpawn",type:n,land:e,x:r,y:a})}logEnemyDeath(n,e,r){this.addEvent({timestamp:Date.now(),event:"enemyDeath",type:n,killedBy:e,overkillStr:r})}logEnemyHit(n,e){this.addEvent({timestamp:Date.now(),event:"enemyHit",type:n,amountStr:e.toString()})}logPlayerHit(n){this.addEvent({timestamp:Date.now(),event:"playerHit",amountStr:n.toString()})}logProjectileSpawn(n){this.addEvent({timestamp:Date.now(),event:"projectileSpawn",side:n})}logProjectileDespawn(n){this.addEvent({timestamp:Date.now(),event:"projectileDespawn",reason:n})}logBossSpawn(){this.addEvent({timestamp:Date.now(),event:"bossSpawn"})}logBossDeath(){this.addEvent({timestamp:Date.now(),event:"bossDeath"})}logFPSDrop(n,e){this.addEvent({timestamp:Date.now(),event:"fpsDrop",fps:n,durationMs:e})}exportNDJSON(){return this.buffer.join(`
`)}downloadLogs(){const n=this.exportNDJSON(),e=new Blob([n],{type:"application/x-ndjson"}),r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=`dragonchronicles-logs-${new Date().toISOString().slice(0,19)}.ndjson`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}clearLogs(){this.buffer=[],localStorage.removeItem("dragonChronicles_telemetry")}getBufferSize(){return this.buffer.length}persistBuffer(){try{const n=JSON.stringify(this.buffer.slice(-1e3));localStorage.setItem("dragonChronicles_telemetry",n)}catch(n){console.warn("Failed to persist telemetry buffer:",n)}}loadPersistedBuffer(){try{const n=localStorage.getItem("dragonChronicles_telemetry");if(n){const e=JSON.parse(n);Array.isArray(e)&&(this.buffer=e)}}catch(n){console.warn("Failed to load persisted telemetry buffer:",n)}}}const ne=new We;typeof window<"u"&&ne.loadPersistedBuffer();const ue={TICK_MS:1e3,IDLE_UPDATE_HZ:10,ACTIVE_UPDATE_HZ:60,IDLE_UPDATE_MS:100,ACTIVE_UPDATE_MS:16};let c,we;function be(t){return{saveVersion:t.saveVersion,currencies:{arcana:new f(t.currencies.arcana),forgegold:new f(t.currencies.forgegold),dragonscales:new f(t.currencies.dragonscales),gems:new f(t.currencies.gems)},runTotalDistanceKm:new f(t.runTotalDistanceKm),lifetimeTotalDistanceKm:new f(t.lifetimeTotalDistanceKm),lifetimeMaxTotalDistanceKm:new f(t.lifetimeMaxTotalDistanceKm),currentLevel:t.currentLevel,levelDistanceKm:new f(t.levelDistanceKm),enchants:t.enchants,dragonHp:t.dragonHp,dragonMaxHp:t.dragonMaxHp,travelState:t.travelState,lastSaveTimestampMs:new f(t.lastSaveTimestampMs),ewma:{arcanaPerSec:new f(t.ewma.arcana),alpha:new f(t.ewma.alpha),samples:0},debugMode:t.debugMode,lastUpdateMs:Date.now(),tickAccumulator:0,isAnimating:!1}}function je(t){return{saveVersion:t.saveVersion,currencies:{arcana:t.currencies.arcana.toString(),forgegold:t.currencies.forgegold.toString(),dragonscales:t.currencies.dragonscales.toString(),gems:t.currencies.gems.toString()},runTotalDistanceKm:t.runTotalDistanceKm.toString(),lifetimeTotalDistanceKm:t.lifetimeTotalDistanceKm.toString(),lifetimeMaxTotalDistanceKm:t.lifetimeMaxTotalDistanceKm.toString(),currentLevel:t.currentLevel,levelDistanceKm:t.levelDistanceKm.toString(),enchants:t.enchants,dragonHp:t.dragonHp,dragonMaxHp:t.dragonMaxHp,travelState:t.travelState,lastSaveTimestampMs:new f(Date.now()).toString(),ewma:{arcana:t.ewma.arcanaPerSec.toString(),alpha:t.ewma.alpha.toString()},notation:"scientific-ee@e100",debugMode:t.debugMode}}function Je(t){return{currentLevel:t.currentLevel,levelProgress:Ye(t.runTotalDistanceKm),runTotalDistanceKm:t.runTotalDistanceKm.toString(),dragonHp:t.dragonHp,dragonMaxHp:t.dragonMaxHp,travelState:t.travelState,currencies:{arcana:t.currencies.arcana.toString(),forgegold:t.currencies.forgegold.toString(),dragonscales:t.currencies.dragonscales.toString(),gems:t.currencies.gems.toString()},enchants:t.enchants,lifetimeTotalDistanceKm:t.lifetimeTotalDistanceKm.toString(),lifetimeMaxTotalDistanceKm:t.lifetimeMaxTotalDistanceKm.toString(),ewmaArcanaPerSec:t.ewma.arcanaPerSec.toString(),debugMode:t.debugMode}}function $e(){const t=new f(c.enchants.firepower.level).mul(.1),n=new f(c.enchants.scales.level).mul(.05),e=new f(1).plus(t).plus(n),r=c.travelState==="ADVANCING"?new f(.044):new f(0);return{arcanaPerSec:e,distancePerSec:r}}function Qe(){const t=$e();if(c.currencies.arcana=c.currencies.arcana.plus(t.arcanaPerSec),c.travelState==="ADVANCING"){c.runTotalDistanceKm=c.runTotalDistanceKm.plus(t.distancePerSec),c.levelDistanceKm=c.levelDistanceKm.plus(t.distancePerSec);const n=me(c.runTotalDistanceKm);n!==c.currentLevel&&(c.currentLevel=n,c.levelDistanceKm=new f(0))}else c.travelState==="RETREATING"&&(c.runTotalDistanceKm=c.runTotalDistanceKm.minus(t.distancePerSec),c.runTotalDistanceKm.lt(0)&&(c.runTotalDistanceKm=new f(0),c.travelState="HOVERING"),c.currentLevel=me(c.runTotalDistanceKm));Ue(c.ewma,t.arcanaPerSec),c.ewma.samples%10===0&&ne.logRateSample(c.ewma.arcanaPerSec)}function Be(){const n=Date.now()-c.lastUpdateMs,e=c.isAnimating?ue.ACTIVE_UPDATE_MS:ue.IDLE_UPDATE_MS;return n>=e}function et(){if(Be()){const t=Je(c);postMessage({type:"state:update",state:t}),c.lastUpdateMs=Date.now()}}function tt(t){if(c.debugMode)switch(t.type){case"add-arcana":c.currencies.arcana=c.currencies.arcana.plus(t.amount);break;case"force-hp":c.dragonHp=Math.max(1,Math.min(100,t.percentage));break;case"free-level":const n=c.enchants[t.enchant];n.level=Math.min(500,n.level+t.amount);break;case"free-tier":c.enchants[t.enchant].tierUnlocked=t.tier;break}}self.onmessage=t=>{const n=t.data;try{switch(n.type){case"init":Ze().then(()=>{const d=n.state||Ve();c=be(d),we||(typeof window<"u"?window.__workerActive=!0:self.__workerActive=!0,we=setInterval(()=>{for(c.tickAccumulator+=16;c.tickAccumulator>=ue.TICK_MS;)Qe(),c.tickAccumulator-=ue.TICK_MS;et()},16))});break;case"tick":break;case"control":switch(n.cmd){case"start":c.travelState="ADVANCING",c.isAnimating=!0;break;case"stop":c.travelState="HOVERING",c.isAnimating=!1;break;case"reverse":c.travelState="RETREATING",c.isAnimating=!0;break}break;case"purchase-enchant":const e=c.enchants[n.which],r=Xe(e,c.currencies.arcana,n.which);r.success&&r.cost&&(c.currencies.arcana=r.newArcana,e.level++,ne.logPurchase(n.which,e.level-1,e.level,r.cost,c.currencies.arcana));break;case"tier-up":const a=c.enchants[n.which],i=_e(a,c.currencies.arcana,n.which);if(i.success&&i.cost){c.currencies.arcana=i.newArcana;const d=a.tierUnlocked;a.tierUnlocked=Math.min(3,a.tierUnlocked+1),ne.logTierUp(n.which,d,i.cost,c.currencies.arcana)}break;case"select-tier":const l=c.enchants[n.which];n.tier<=l.tierUnlocked;break;case"reset-run":const o=c.runTotalDistanceKm;c.lifetimeTotalDistanceKm=c.lifetimeTotalDistanceKm.plus(o),c.lifetimeMaxTotalDistanceKm=f.max(c.lifetimeMaxTotalDistanceKm,o),c.runTotalDistanceKm=new f(0),c.levelDistanceKm=new f(0),c.currentLevel=1,c.enchants.firepower={level:0,tierUnlocked:1},c.enchants.scales={level:0,tierUnlocked:1},c.travelState="HOVERING",c.isAnimating=!1,ne.logResetJourney(o,c.lifetimeTotalDistanceKm),postMessage({type:"toast",text:"Journey Ended, returning to Draconia."});break;case"request-offline-apply":const h=je(c),m=Ge(h);if(m.wasOffline){Re(h,m),c=be(h);const d=m.elapsedMs.div(36e5).toNumber();postMessage({type:"offline-welcome",elapsedHours:d,arcanaGain:m.arcanaGain.toString()}),ne.logOfflinePayout(m.appliedMs.div(1e3),c.ewma.arcanaPerSec,m.arcanaGain)}break;case"debug":tt(n.action);break}}catch(e){postMessage({type:"error",message:`Worker error: ${e}`})}};

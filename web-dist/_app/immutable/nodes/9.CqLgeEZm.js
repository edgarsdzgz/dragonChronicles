import"../chunks/DsnmJJEf.js";import{i as pe}from"../chunks/CP9tZzGG.js";import{g as ue,o as he,A as ve,i as P,u as D,B as x,k as z,l as me,r as i,q as s,w as e,n as c,m as l,t as d,v as b,C as V}from"../chunks/DzhVMzrA.js";import{i as j}from"../chunks/DSEsMLIz.js";import{b as fe}from"../chunks/Dh9k4Bes.js";import{T as G,S as K,R as xe}from"../chunks/B2cBvE-Z.js";import{A as be}from"../chunks/Bdegg2L_.js";import{A as O}from"../chunks/D5Hk05_A.js";var ye=P('<div style="font-size:10px; color:#888;"> </div>'),we=P('<div style="font-size:10px; color:#888;"> </div>'),_e=P('<div style="position:fixed; inset:0; background: #1a1a2e;"><canvas style="width:100%; height:100%; display:block;"></canvas> <div style="position:absolute; right:8px; top:8px; background:rgba(0,0,0,.8); color:#fff; padding:12px; border-radius:8px; font:12px system-ui; min-width:200px;"><h3 style="margin:0 0 8px 0; font-size:14px;">Working Dragon Test</h3> <div style="margin-bottom:8px;"><button style="margin:2px; padding:6px 12px; background:#4CAF50;">Spawn Dragon</button> <button style="margin:2px; padding:6px 12px; background:#2196F3;">Spawn Animated</button></div> <div style="margin-bottom:8px;"><button style="margin:2px; padding:6px 12px; background:#FF9800;">Start Animation</button> <button style="margin:2px; padding:6px 12px; background:#9C27B0;">Stop Animation</button></div> <div style="margin-bottom:8px;"><button style="margin:2px; padding:6px 12px; background:#f44336;">Recycle All</button></div> <div style="border-top:1px solid #444; padding-top:8px; margin-top:8px;"><div> </div> <div style="font-size:10px; color:#888;"> </div> <!> <!> <div style="font-size:10px; color:#888;"> </div></div></div></div>');function ze(Q,U){ue(U,!1);let v=c(),o,p=c(0),r=c(null),n=c([]),g=c(!1),_=[],m=[],u=c(null),h=c(0);async function X(){try{console.log("Starting texture load with Assets system..."),O.add({alias:"dragon-sheet",src:"/sprites/dragon_fly_128_sheet.svg"}),l(r,await O.load("dragon-sheet")),e(r)?(console.log("Dragon texture loaded successfully via Assets:",{width:e(r).width,height:e(r).height}),await M(),l(g,!0)):console.error("Texture loaded but null:",e(r))}catch(t){console.error("Failed to load dragon texture via Assets:",t);try{console.log("Trying fallback Texture.from..."),l(r,G.from("/sprites/dragon_fly_128_sheet.svg")),await new Promise(a=>setTimeout(a,2e3)),e(r)?(console.log("Fallback Texture.from loaded:",{width:e(r).width,height:e(r).height}),await M(),l(g,!0)):console.error("Fallback texture still null:",e(r))}catch(a){console.error("Fallback texture loading also failed:",a)}}}async function M(){if(!e(r))return;console.log("Creating dragon frame textures...");const t=128,a=128,f=2,ge=2;l(n,[]);for(let y=0;y<ge;y++)for(let w=0;w<f;w++){const L=w*t,N=y*a,ce=new G({source:e(r).source,frame:new xe(L,N,t,a)});e(n).push(ce),console.log(`Created frame ${e(n).length}: ${y},${w} at ${L},${N}`)}console.log(`Created ${e(n).length} dragon frames`)}function Y(){if(console.log("Spawn animated dragon called:",{loaded:e(g),frames:e(n).length}),!e(g)||e(n).length===0||!o){console.log("Cannot spawn animated dragon - not ready:",{loaded:e(g),framesCount:e(n).length,appExists:!!o});return}const t=new K(e(n)[0]);t.visible=!0,t.position.set(Math.random()*(o.renderer.width-128),Math.random()*(o.renderer.height-128)),t.scale.set(.5),t.anchor.set(.5),console.log("Adding animated sprite to stage:",{sprite:t,position:t.position,visible:t.visible,stageChildren:o.stage.children.length}),o.stage.addChild(t),m.push(t),V(p),o.renderer.render(o.stage),console.log("Animated dragon spawned successfully, total:",e(p),{stageChildren:o.stage.children.length,animatedSprites:m.length})}function Z(){if(e(u)){console.log("Animation already running");return}if(e(n).length===0){console.log("No frames available for animation");return}console.log("Starting dragon animation at 2 FPS..."),l(u,setInterval(()=>{l(h,(e(h)+1)%e(n).length);const t=e(n)[e(h)];if(t)for(const a of m)a.texture=t;o&&o.renderer.render(o.stage),console.log(`Animation frame: ${e(h)+1}/${e(n).length}`)},500))}function k(){e(u)&&(clearInterval(e(u)),l(u,null),console.log("Animation stopped"))}function ee(){if(console.log("Spawn dragon called:",{loaded:e(g),dragonTexture:!!e(r)}),!e(g)||!e(r)){console.log("Cannot spawn dragon - texture not ready:",{loaded:e(g),textureExists:!!e(r)});return}const t=new K(e(r));t.visible=!0,t.position.set(Math.random()*(o.renderer.width-128),Math.random()*(o.renderer.height-128)),t.scale.set(.5),t.anchor.set(.5),console.log("Adding sprite to stage:",{sprite:t,position:t.position,visible:t.visible,stageChildren:o.stage.children.length,stage:o.stage}),o.stage.addChild(t),_.push(t),V(p),o.renderer.render(o.stage),console.log("Dragon spawned successfully, total:",e(p),{stageChildren:o.stage.children.length,spritePosition:t.position,spriteVisible:t.visible,rendererWidth:o.renderer.width,rendererHeight:o.renderer.height})}function te(){k();for(const t of _)o.stage.removeChild(t),t.destroy();_=[];for(const t of m)o.stage.removeChild(t),t.destroy();m=[],l(p,0),l(h,0),console.log("All dragons recycled")}he(async()=>{console.log("Mounting PixiJS app..."),await new Promise(t=>setTimeout(t,1e3));try{o=new be,await o.init({view:e(v),backgroundAlpha:0,antialias:!1,resolution:1,autoDensity:!0}),o.ticker&&o.ticker.stop(),o.renderer.resize(e(v).clientWidth,e(v).clientHeight),console.log("PixiJS app initialized:",{width:o.renderer.width,height:o.renderer.height,stage:o.stage,tickerRunning:o.ticker?.started}),await X()}catch(t){console.error("Failed to initialize PixiJS app:",t)}}),ve(()=>{console.log("Destroying PixiJS app..."),k(),o?.destroy(!0,{children:!0})}),pe();var A=_e(),R=i(A);fe(R,t=>l(v,t),()=>e(v));var J=s(R,2),S=s(i(J),2),W=i(S),oe=s(W,2);d(S);var C=s(S,2),E=i(C),re=s(E,2);d(C);var T=s(C,2),ae=i(T);d(T);var H=s(T,2),F=i(H),ne=i(F);d(F);var $=s(F,2),ie=i($,!0);d($);var I=s($,2);{var se=t=>{var a=ye(),f=i(a);d(a),D(()=>b(f,`Texture size: ${e(r).width??""}x${e(r).height??""}`)),z(t,a)};j(I,t=>{e(r)&&t(se)})}var B=s(I,2);{var le=t=>{var a=we(),f=i(a);d(a),D(()=>b(f,`Frames: ${e(n).length??""} | Current: ${e(h)+1}`)),z(t,a)};j(B,t=>{e(n).length>0&&t(le)})}var q=s(B,2),de=i(q);d(q),d(H),d(J),d(A),D(()=>{b(ne,`Spawned: ${e(p)??""}`),b(ie,e(g)?"Texture loaded âœ“":"Loading texture..."),b(de,`Animation: ${e(u)?"Running":"Stopped"}`)}),x("click",W,ee),x("click",oe,Y),x("click",E,Z),x("click",re,k),x("click",ae,te),z(Q,A),me()}export{ze as component};

var x=Object.defineProperty;var F=(i,t,e)=>t in i?x(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>F(i,typeof t!="symbol"?t+"":t,e);import"./DsnmJJEf.js";import{i as D}from"./CP9tZzGG.js";import{g as E,o as P,m as o,n as w,A as j,i as f,j as z,w as y,q as d,k as u,l as B,r as c,t as v,B as U}from"./DzhVMzrA.js";import{i as m}from"./DSEsMLIz.js";class N{constructor(){l(this,"registration",null);l(this,"updateAvailable",!1);l(this,"installing",!1);l(this,"installed",!1);l(this,"updateCallbacks",[]);this.initializeServiceWorker()}async initializeServiceWorker(){if(typeof window>"u"||!("serviceWorker"in navigator)){console.warn("Service Worker not supported");return}try{this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker: Registered successfully"),this.registration.addEventListener("updatefound",()=>{const t=this.registration?.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&(console.log("Service Worker: Update available"),this.updateAvailable=!0,this.notifyCallbacks())})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("Service Worker: Now controlling"),this.installed=!0,this.installing=!1,this.notifyCallbacks()})}catch(t){console.error("Service Worker registration failed:",t)}}async checkForUpdates(){if(!this.registration)return!1;try{return await this.registration.update(),this.updateAvailable}catch(t){return console.error("Failed to check for updates:",t),!1}}async applyUpdate(){if(!(!this.registration||!this.updateAvailable))try{this.installing=!0,this.notifyCallbacks(),this.registration.waiting&&this.registration.waiting.postMessage({type:"SKIP_WAITING"})}catch(t){console.error("Failed to apply update:",t),this.installing=!1,this.notifyCallbacks()}}onUpdate(t){return this.updateCallbacks.push(t),()=>{const e=this.updateCallbacks.indexOf(t);e>-1&&this.updateCallbacks.splice(e,1)}}getUpdateInfo(){return{isUpdateAvailable:this.updateAvailable,isInstalling:this.installing,isInstalled:this.installed}}canInstall(){return"serviceWorker"in navigator&&"PushManager"in window}async install(){if(!this.canInstall())return!1;try{return this.registration!==null}catch(t){return console.error("Failed to install PWA:",t),!1}}notifyCallbacks(){const t=this.getUpdateInfo();this.updateCallbacks.forEach(e=>e(t))}}let p=null;function I(){return p||(p=new N),p}var T=f('<div class="update-toast svelte-edu13u" role="alert" aria-live="polite"><div class="update-toast__content svelte-edu13u"><div class="update-toast__icon svelte-edu13u"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-edu13u"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor" class="svelte-edu13u"></path></svg></div> <div class="update-toast__text svelte-edu13u"><div class="update-toast__title svelte-edu13u">Update Available</div> <div class="update-toast__message svelte-edu13u">A new version of Draconia Chronicles is ready to install.</div></div> <div class="update-toast__actions svelte-edu13u"><button class="update-toast__button update-toast__button--primary svelte-edu13u" aria-label="Install update">Update</button> <button class="update-toast__button update-toast__button--secondary svelte-edu13u" aria-label="Dismiss update notification">Later</button></div></div></div>'),q=f('<div class="update-toast update-toast--installing svelte-edu13u" role="status" aria-live="polite"><div class="update-toast__content svelte-edu13u"><div class="update-toast__icon svelte-edu13u"><div class="update-toast__spinner svelte-edu13u"></div></div> <div class="update-toast__text svelte-edu13u"><div class="update-toast__title svelte-edu13u">Installing Update</div> <div class="update-toast__message svelte-edu13u">Please wait while we install the latest version...</div></div></div></div>'),G=f("<!> <!>",1);function H(i,t){E(t,!1);let e=w({isUpdateAvailable:!1,isInstalling:!1,isInstalled:!1}),r=w(!1),n=null;P(()=>{if(typeof window>"u")return;const a=I();n=a.onUpdate(s=>{o(e,s),o(r,s.isUpdateAvailable&&!s.isInstalling)}),a.checkForUpdates()}),j(()=>{n&&n()});async function W(){await I().applyUpdate()}function A(){o(r,!1)}D();var g=G(),h=z(g);{var C=a=>{var s=T(),_=c(s),b=d(c(_),4),k=c(b),S=d(k,2);v(b),v(_),v(s),U("click",k,W),U("click",S,A),u(a,s)};m(h,a=>{y(r)&&a(C)})}var L=d(h,2);{var M=a=>{var s=q();u(a,s)};m(L,a=>{y(e).isInstalling&&a(M)})}u(i,g),B()}export{H as default};

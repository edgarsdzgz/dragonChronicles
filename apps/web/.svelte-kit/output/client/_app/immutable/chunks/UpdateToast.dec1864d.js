var P=Object.defineProperty;var B=(l,t,e)=>t in l?P(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var g=(l,t,e)=>(B(l,typeof t!="symbol"?t+"":t,e),e);import{s as O,n as T,o as j,b as z,r as q}from"./scheduler.86f77edc.js";import{S as G,i as K,s as m,e as E,c as I,a as C,d as h,b as p,f as v,g as M,m as b,o as r,k as u,n as V}from"./index.e78d2784.js";class R{constructor(){g(this,"registration",null);g(this,"updateAvailable",!1);g(this,"installing",!1);g(this,"installed",!1);g(this,"updateCallbacks",[]);this.initializeServiceWorker()}async initializeServiceWorker(){if(typeof window>"u"||!("serviceWorker"in navigator)){console.warn("Service Worker not supported");return}try{this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker: Registered successfully"),this.registration.addEventListener("updatefound",()=>{const t=this.registration?.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&(console.log("Service Worker: Update available"),this.updateAvailable=!0,this.notifyCallbacks())})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("Service Worker: Now controlling"),this.installed=!0,this.installing=!1,this.notifyCallbacks()})}catch(t){console.error("Service Worker registration failed:",t)}}async checkForUpdates(){if(!this.registration)return!1;try{return await this.registration.update(),this.updateAvailable}catch(t){return console.error("Failed to check for updates:",t),!1}}async applyUpdate(){if(!(!this.registration||!this.updateAvailable))try{this.installing=!0,this.notifyCallbacks(),this.registration.waiting&&this.registration.waiting.postMessage({type:"SKIP_WAITING"})}catch(t){console.error("Failed to apply update:",t),this.installing=!1,this.notifyCallbacks()}}onUpdate(t){return this.updateCallbacks.push(t),()=>{const e=this.updateCallbacks.indexOf(t);e>-1&&this.updateCallbacks.splice(e,1)}}getUpdateInfo(){return{isUpdateAvailable:this.updateAvailable,isInstalling:this.installing,isInstalled:this.installed}}canInstall(){return"serviceWorker"in navigator&&"PushManager"in window}async install(){if(!this.canInstall())return!1;try{return this.registration!==null}catch(t){return console.error("Failed to install PWA:",t),!1}}notifyCallbacks(){const t=this.getUpdateInfo();this.updateCallbacks.forEach(e=>e(t))}}let W=null;function H(){return W||(W=new R),W}function N(l){let t,e,a,i='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="currentColor"></path></svg>',s,n,y='<div class="update-toast__title svelte-1xi6sk9">Update Available</div> <div class="update-toast__message svelte-1xi6sk9">A new version of Draconia Chronicles is ready to install.</div>',f,o,d,A="Update",U,c,D="Later",L,S;return{c(){t=p("div"),e=p("div"),a=p("div"),a.innerHTML=i,s=m(),n=p("div"),n.innerHTML=y,f=m(),o=p("div"),d=p("button"),d.textContent=A,U=m(),c=p("button"),c.textContent=D,this.h()},l(k){t=v(k,"DIV",{class:!0,role:!0,"aria-live":!0});var x=M(t);e=v(x,"DIV",{class:!0});var _=M(e);a=v(_,"DIV",{class:!0,"data-svelte-h":!0}),b(a)!=="svelte-d4jb62"&&(a.innerHTML=i),s=I(_),n=v(_,"DIV",{class:!0,"data-svelte-h":!0}),b(n)!=="svelte-1ppd44y"&&(n.innerHTML=y),f=I(_),o=v(_,"DIV",{class:!0});var w=M(o);d=v(w,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),b(d)!=="svelte-rdfpo6"&&(d.textContent=A),U=I(w),c=v(w,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),b(c)!=="svelte-xp60fw"&&(c.textContent=D),w.forEach(h),_.forEach(h),x.forEach(h),this.h()},h(){r(a,"class","update-toast__icon svelte-1xi6sk9"),r(n,"class","update-toast__text svelte-1xi6sk9"),r(d,"class","update-toast__button update-toast__button--primary svelte-1xi6sk9"),r(d,"aria-label","Install update"),r(c,"class","update-toast__button update-toast__button--secondary svelte-1xi6sk9"),r(c,"aria-label","Dismiss update notification"),r(o,"class","update-toast__actions svelte-1xi6sk9"),r(e,"class","update-toast__content svelte-1xi6sk9"),r(t,"class","update-toast svelte-1xi6sk9"),r(t,"role","alert"),r(t,"aria-live","polite")},m(k,x){C(k,t,x),u(t,e),u(e,a),u(e,s),u(e,n),u(e,f),u(e,o),u(o,d),u(o,U),u(o,c),L||(S=[V(d,"click",l[2]),V(c,"click",l[3])],L=!0)},p:T,d(k){k&&h(t),L=!1,q(S)}}}function F(l){let t,e='<div class="update-toast__content svelte-1xi6sk9"><div class="update-toast__icon svelte-1xi6sk9"><div class="update-toast__spinner svelte-1xi6sk9"></div></div> <div class="update-toast__text svelte-1xi6sk9"><div class="update-toast__title svelte-1xi6sk9">Installing Update</div> <div class="update-toast__message svelte-1xi6sk9">Please wait while we install the latest version...</div></div></div>';return{c(){t=p("div"),t.innerHTML=e,this.h()},l(a){t=v(a,"DIV",{class:!0,role:!0,"aria-live":!0,"data-svelte-h":!0}),b(t)!=="svelte-b76ve3"&&(t.innerHTML=e),this.h()},h(){r(t,"class","update-toast update-toast--installing svelte-1xi6sk9"),r(t,"role","status"),r(t,"aria-live","polite")},m(a,i){C(a,t,i)},d(a){a&&h(t)}}}function Z(l){let t,e,a=l[1]&&N(l),i=l[0].isInstalling&&F();return{c(){a&&a.c(),t=m(),i&&i.c(),e=E()},l(s){a&&a.l(s),t=I(s),i&&i.l(s),e=E()},m(s,n){a&&a.m(s,n),C(s,t,n),i&&i.m(s,n),C(s,e,n)},p(s,[n]){s[1]?a?a.p(s,n):(a=N(s),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),s[0].isInstalling?i||(i=F(),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:T,o:T,d(s){s&&(h(t),h(e)),a&&a.d(s),i&&i.d(s)}}}function J(l,t,e){let a={isUpdateAvailable:!1,isInstalling:!1,isInstalled:!1},i=!1,s=null;j(()=>{if(typeof window>"u")return;const f=H();s=f.onUpdate(o=>{e(0,a=o),e(1,i=o.isUpdateAvailable&&!o.isInstalling)}),f.checkForUpdates()}),z(()=>{s&&s()});async function n(){await H().applyUpdate()}function y(){e(1,i=!1)}return[a,i,n,y]}class $ extends G{constructor(t){super(),K(this,t,J,Z,O,{})}}export{$ as default};

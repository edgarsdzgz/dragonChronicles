var m=Object.defineProperty;var w=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(w(r,typeof e!="symbol"?e+"":e,t),t);import{T as y,R as x,S as F}from"./index.29d1603d.js";import{A as p}from"./Assets.eee396a8.js";class P{constructor(e){a(this,"baseTexture",null);a(this,"frames",new Map);a(this,"config");a(this,"initialized",!1);this.config=e}async initialize(){if(!(this.initialized||typeof window>"u"))try{if(console.log(`Loading texture using Assets API: ${this.config.imagePath}`),this.baseTexture=await p.load(this.config.imagePath),!this.baseTexture)throw new Error(`Failed to load texture: ${this.config.imagePath}`);console.log(`Texture loaded successfully: ${this.config.imagePath}`,{width:this.baseTexture.width,height:this.baseTexture.height,valid:this.baseTexture.valid,source:this.baseTexture.source}),this.generateFrames(this.config),this.initialized=!0,console.log(`TextureAtlas initialized: ${this.config.imagePath} (${this.frames.size} frames)`)}catch(e){throw console.error("Failed to initialize TextureAtlas:",e),console.error("Error details:",{message:e.message,stack:e.stack,imagePath:this.config.imagePath}),e}}generateFrames(e){if(!this.baseTexture)return;const{frameWidth:t,frameHeight:i,rows:o,cols:g,spacing:l=0}=e;for(let s=0;s<o;s++)for(let n=0;n<g;n++){const h=n*(t+l),c=s*(i+l),f=`${s}_${n}`,d={texture:new y({source:this.baseTexture.source,frame:new x(h,c,t,i)}),x:h,y:c,width:t,height:i};this.frames.set(f,d)}}async getFrame(e,t){return await this.initialize(),this.frames.get(`${e}_${t}`)}async getFrameByIndex(e){await this.initialize();const t=this.config,i=Math.floor(e/t.cols),o=e%t.cols;return this.getFrame(i,o)}async getAllFrames(){return await this.initialize(),Array.from(this.frames.values())}async getFrameCount(){return await this.initialize(),this.frames.size}}const v=new P({imagePath:"/sprites/dragon_fly_128_sheet.svg",frameWidth:128,frameHeight:128,rows:2,cols:2});class I{constructor(e,t,i){a(this,"sprite");a(this,"isPlaying",!1);a(this,"currentFrameIndex",0);a(this,"intervalId",null);a(this,"frameSequence",["idle","fly_1","fly_2","fly_3"]);a(this,"frameDuration",125);a(this,"renderer",null);a(this,"stage",null);this.sprite=e,this.renderer=t||null,this.stage=i||null}async start(){this.isPlaying||(this.isPlaying=!0,await this.updateFrame(),this.intervalId=window.setInterval(async()=>{this.isPlaying&&(this.currentFrameIndex=(this.currentFrameIndex+1)%this.frameSequence.length,await this.updateFrame())},this.frameDuration))}stop(){this.isPlaying=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}pause(){this.isPlaying=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}resume(){this.isPlaying||this.start()}async updateFrame(){try{const e=this.frameSequence[this.currentFrameIndex],t=await u(e);if(t){if(this.sprite.texture=t.texture,console.log(`Dragon frame updated to: ${e}`,{textureValid:t.texture?.source?.valid,textureWidth:t.texture?.width,textureHeight:t.texture?.height}),this.renderer&&this.stage)this.renderer.render(this.stage);else if(this.sprite.stage&&"renderer"in this.sprite.stage){const i=this.sprite.stage;i.renderer&&i.renderer.render(i)}}else console.warn(`Failed to load frame: ${e}`)}catch(e){console.error("Error updating dragon frame:",e)}}getCurrentFrame(){return this.frameSequence[this.currentFrameIndex]}isAnimating(){return this.isPlaying}setFPS(e){if(e<=0){console.warn("FPS must be greater than 0");return}this.frameDuration=1e3/e,console.log(`Dragon animation FPS changed to: ${e} (${this.frameDuration}ms per frame)`),this.isPlaying&&(this.stop(),this.start())}getFPS(){return 1e3/this.frameDuration}destroy(){this.stop()}}const $={idle:{row:0,col:0},fly_1:{row:0,col:1},fly_2:{row:1,col:0},fly_3:{row:1,col:1}};async function u(r){try{const{row:e,col:t}=$[r],i=await v.getFrame(e,t);if(!i){console.error(`Failed to get dragon frame: ${r} (${e}, ${t})`);return}return i}catch(e){console.error(`Error loading dragon frame ${r}:`,e);return}}async function T(r="idle"){const e=await u(r);if(!e)throw new Error(`Invalid dragon frame type: ${r}`);const t=new F(e.texture);return t.anchor.set(.5),t}async function D(r,e){const t=await T("idle"),i=new I(t,r,e);return{sprite:t,animator:i}}export{P as T,D as c,u as g};

var ni=Object.defineProperty;var ii=(n,i,a)=>i in n?ni(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var T=(n,i,a)=>(ii(n,typeof i!="symbol"?i+"":i,a),a);import{s as oi,n as wn,r as ai,o as si,b as li,d as di}from"../chunks/scheduler.86f77edc.js";import{S as ci,i as ui,b as d,s as y,t as u,f as c,g as _,d as x,c as w,m as ge,h as p,j as e,o as Be,a as Jn,k as t,p as sr,n as ae,l as te,q as _n}from"../chunks/index.e78d2784.js";import{S as Kn}from"../chunks/index.29d1603d.js";import{T as Qn,c as Gn}from"../chunks/dragon-sprites.24d3ff80.js";import{A as pi}from"../chunks/Application.778f7409.js";import{G as yn}from"../chunks/Graphics.83a923f7.js";const fi={frameSpeedMultipliers:{idle:1,fly_1:1,fly_2:1,fly_3:1},smoothTransitions:!0,transitionDuration:50},hi={frameSpeedMultipliers:{idle:.5,fly_1:.5,fly_2:.5,fly_3:2},smoothTransitions:!0,transitionDuration:75,frameDurationExtensions:{idle:0,fly_1:0,fly_2:0,fly_3:5},frameSpeedDecay:{idle:{startMultiplier:.5,endMultiplier:.5},fly_1:{startMultiplier:.5,endMultiplier:.5},fly_2:{startMultiplier:.5,endMultiplier:.5},fly_3:{startMultiplier:2,endMultiplier:.5}}},mi={"mantair-corsair":hi,swarm:fi},gi={"mantair-corsair":{name:"Mantair Corsair",imagePath:"/sprites/wsn_mantairCorsair_sprite.svg",frameWidth:128,frameHeight:128,rows:2,cols:2},swarm:{name:"Swarm",imagePath:"/sprites/wsn_swarm_sprite.svg",frameWidth:128,frameHeight:128,rows:2,cols:2}},vi={idle:{row:0,col:0},fly_1:{row:0,col:1},fly_2:{row:1,col:0},fly_3:{row:1,col:1}},Zn={};for(const[n,i]of Object.entries(gi))Zn[n]=new Qn({imagePath:i.imagePath,frameWidth:i.frameWidth,frameHeight:i.frameHeight,rows:i.rows,cols:i.cols});async function ei(n,i){try{const a=Zn[n];if(!a){console.error(`No atlas found for enemy type: ${n}`);return}const{row:v,col:F}=vi[i],o=await a.getFrame(v,F);if(!o){console.error(`Failed to get enemy frame: ${n} ${i} (${v}, ${F})`);return}return o}catch(a){console.error(`Error loading enemy frame ${n} ${i}:`,a);return}}async function bi(n,i="idle"){const a=await ei(n,i);if(!a)throw new Error(`Invalid enemy frame: ${n} ${i}`);const v=new Kn(a.texture);return v.anchor.set(.5),v}class xi{constructor(i,a,v,F){T(this,"sprite");T(this,"enemyType");T(this,"isPlaying",!1);T(this,"currentFrameIndex",0);T(this,"intervalId",null);T(this,"frameSequence",["idle","fly_1","fly_2","fly_3"]);T(this,"frameDuration",125);T(this,"renderer",null);T(this,"stage",null);T(this,"movementPattern");T(this,"currentSpeedMultiplier",1);T(this,"targetSpeedMultiplier",1);T(this,"speedTransitionStart",0);T(this,"onFrameChange");T(this,"frameExtensionCounter",0);T(this,"currentExtendedFrame",null);this.sprite=i,this.enemyType=a,this.renderer=v||null,this.stage=F||null,this.movementPattern=mi[a],this.currentSpeedMultiplier=this.movementPattern.frameSpeedMultipliers.idle,this.targetSpeedMultiplier=this.currentSpeedMultiplier}setFrameChangeCallback(i){this.onFrameChange=i}getCurrentSpeedMultiplier(){if(this.currentExtendedFrame&&this.frameExtensionCounter>0){const o=this.movementPattern.frameSpeedDecay?.[this.currentExtendedFrame];if(o){const C=(this.movementPattern.frameDurationExtensions?.[this.currentExtendedFrame]||0)+1,M=this.frameExtensionCounter+1,j=(C-M)/C,z=o.startMultiplier+(o.endMultiplier-o.startMultiplier)*j;return console.log(`${this.enemyType} decay: ${o.startMultiplier.toFixed(2)}x → ${o.endMultiplier.toFixed(2)}x (progress: ${(j*100).toFixed(1)}%)`),z}}if(!this.movementPattern.smoothTransitions)return this.targetSpeedMultiplier;const a=performance.now()-this.speedTransitionStart;if(a>=this.movementPattern.transitionDuration)return this.targetSpeedMultiplier;const v=a/this.movementPattern.transitionDuration,F=this.easeInOutCubic(v);return this.currentSpeedMultiplier+(this.targetSpeedMultiplier-this.currentSpeedMultiplier)*F}easeInOutCubic(i){return i<.5?4*i*i*i:1-Math.pow(-2*i+2,3)/2}async start(){this.isPlaying||(this.isPlaying=!0,await this.updateFrame(),this.intervalId=window.setInterval(async()=>{if(this.isPlaying){if(this.currentExtendedFrame&&this.frameExtensionCounter>0){if(this.frameExtensionCounter--,this.onFrameChange){const i=this.getCurrentSpeedMultiplier();this.onFrameChange(this.currentExtendedFrame,i)}console.log(`${this.enemyType} holding extended frame: ${this.currentExtendedFrame} (${this.frameExtensionCounter} remaining)`);return}this.currentFrameIndex=(this.currentFrameIndex+1)%this.frameSequence.length,await this.updateFrame()}},this.frameDuration))}stop(){this.isPlaying=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}pause(){this.isPlaying=!1,this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}resume(){this.isPlaying||this.start()}async updateFrame(){try{const i=this.frameSequence[this.currentFrameIndex],a=await ei(this.enemyType,i);a?(this.sprite.texture=a.texture,console.log(`${this.enemyType} frame updated to: ${i}`),this.updateMovementSpeed(i),this.renderer&&this.stage&&this.renderer.render(this.stage)):console.warn(`Failed to load ${this.enemyType} frame: ${i}`)}catch(i){console.error(`Error updating ${this.enemyType} frame:`,i)}}updateMovementSpeed(i){const a=this.movementPattern.frameSpeedMultipliers[i];a!==this.targetSpeedMultiplier&&(this.currentSpeedMultiplier=this.getCurrentSpeedMultiplier(),this.targetSpeedMultiplier=a,this.speedTransitionStart=performance.now(),console.log(`${this.enemyType} speed transition: ${this.currentSpeedMultiplier.toFixed(2)}x → ${this.targetSpeedMultiplier}x`));const v=this.movementPattern.frameDurationExtensions?.[i]||0;v>0?(this.currentExtendedFrame=i,this.frameExtensionCounter=v,console.log(`${this.enemyType} extending frame ${i} for ${v} extra frames`)):(this.currentExtendedFrame=null,this.frameExtensionCounter=0),this.onFrameChange&&this.onFrameChange(i,this.getCurrentSpeedMultiplier())}getCurrentFrame(){return this.frameSequence[this.currentFrameIndex]}isAnimating(){return this.isPlaying}setFPS(i){if(i<=0){console.warn("FPS must be greater than 0");return}this.frameDuration=1e3/i,console.log(`${this.enemyType} animation FPS changed to: ${i} (${this.frameDuration}ms per frame)`),this.isPlaying&&(this.stop(),this.start())}getFPS(){return 1e3/this.frameDuration}getMovementPattern(){return this.movementPattern}async forceFrame(i,a){const v=this.frameSequence.indexOf(i);if(v===-1){console.warn(`Invalid frame type: ${i}`);return}a?(this.currentFrameIndex=v,this.currentExtendedFrame=i,this.frameExtensionCounter=999,await this.updateFrame(),console.log(`${this.enemyType} forced to hold frame: ${i}`)):(this.currentExtendedFrame=null,this.frameExtensionCounter=0,console.log(`${this.enemyType} resumed normal animation from frame: ${i}`))}destroy(){this.stop()}}async function yi(n,i,a){try{const v=await bi(n,"idle"),F=new xi(v,n,i,a);return console.log(`Created animated ${n} sprite successfully`),{sprite:v,animator:F}}catch(v){throw console.error(`Failed to create animated ${n} sprite:`,v),v}}const Fn={"mantair-corsair-attack":{name:"Mantair Corsair Projectile",imagePath:"/sprites/wsn_mantairCorsair_attack.svg",frameWidth:32,frameHeight:32,rows:2,cols:2,speed:150,scale:.75},"swarm-attack":{name:"Swarm Projectile",imagePath:"/sprites/wsn_swarm_attack.svg",frameWidth:32,frameHeight:32,rows:2,cols:2,speed:200,scale:.75},"dragon-attack":{name:"Dragon Attack Projectile",imagePath:"/sprites/protagonist_dragon_attack.svg",frameWidth:32,frameHeight:32,rows:2,cols:2,speed:250,scale:.75}},wi={idle:{row:0,col:0},fly_1:{row:0,col:1},fly_2:{row:1,col:0},fly_3:{row:1,col:1}},ti={};for(const[n,i]of Object.entries(Fn))ti[n]=new Qn({imagePath:i.imagePath,frameWidth:i.frameWidth,frameHeight:i.frameHeight,rows:i.rows,cols:i.cols});async function ri(n,i){try{const a=ti[n];if(!a){console.error(`No atlas found for projectile type: ${n}`);return}const{row:v,col:F}=wi[i],o=await a.getFrame(v,F);if(!o){console.error(`Failed to get projectile frame: ${n} ${i} (${v}, ${F})`);return}return o}catch(a){console.error(`Error loading projectile frame ${n} ${i}:`,a);return}}async function _i(n,i="idle"){const a=await ri(n,i);if(!a)throw new Error(`Invalid projectile frame: ${n} ${i}`);const v=new Kn(a.texture);return v.anchor.set(.5),v}class Fi{constructor(i,a,v,F,o,g,C){T(this,"sprite");T(this,"projectileType");T(this,"targetX");T(this,"targetY");T(this,"speed");T(this,"isActive",!0);T(this,"animationFrameIndex",0);T(this,"frameSequence",["idle","fly_1","fly_2","fly_3"]);T(this,"lastFrameUpdate",0);T(this,"frameDuration",125);T(this,"renderer",null);T(this,"stage",null);T(this,"collisionCallback");this.sprite=i,this.projectileType=a,this.targetX=v,this.targetY=F,this.speed=Fn[a].speed,this.renderer=o||null,this.stage=g||null,this.collisionCallback=C,this.lastFrameUpdate=performance.now()}update(i){if(!this.isActive)return!1;if(this.updateAnimation(i),this.collisionCallback&&this.collisionCallback(this.sprite))return this.destroy(),!1;const a=this.targetX-this.sprite.x,v=this.targetY-this.sprite.y,F=Math.sqrt(a*a+v*v);if(F<20)return this.destroy(),!1;const o=this.speed*(i/1e3);if(F>0){const g=a/F*o,C=v/F*o;this.sprite.x+=g,this.sprite.y+=C}return this.renderer&&this.stage&&this.renderer.render(this.stage),!0}async updateAnimation(i){const a=performance.now();if(a-this.lastFrameUpdate>=this.frameDuration){this.animationFrameIndex=(this.animationFrameIndex+1)%this.frameSequence.length,this.lastFrameUpdate=a;const v=this.frameSequence[this.animationFrameIndex],F=await ri(this.projectileType,v);F&&(this.sprite.texture=F.texture)}}setFPS(i){this.frameDuration=1e3/i}getSprite(){return this.sprite}isAlive(){return this.isActive}destroy(){this.isActive=!1,this.sprite.parent&&this.sprite.parent.removeChild(this.sprite),this.sprite.destroy()}}async function Un(n,i,a,v,F,o,g,C){const M=await _i(n,"idle");M.position.set(i,a);const J=Fn[n];M.scale.set(J.scale),M.visible=!0;const j=new Fi(M,n,v,F,o,g,C);return g&&g.addChild(M),console.log(`Created ${n} projectile from (${i}, ${a}) to (${v}, ${F}) at scale ${J.scale}`),j}function Ci(n){switch(n){case"mantair-corsair":return"mantair-corsair-attack";case"swarm":return"swarm-attack";default:return"mantair-corsair-attack"}}function Ei(){return"dragon-attack"}function Wn(n){let i,a,v="🎮 Game Running",F,o,g,C=n[13].maxEnemies+"",M,J;return{c(){i=d("div"),a=d("div"),a.textContent=v,F=y(),o=d("div"),g=u("Auto-spawning every ~3 seconds | Max: "),M=u(C),J=u(" enemies"),this.h()},l(j){i=c(j,"DIV",{style:!0});var z=_(i);a=c(z,"DIV",{style:!0,"data-svelte-h":!0}),ge(a)!=="svelte-12rzyap"&&(a.textContent=v),F=w(z),o=c(z,"DIV",{style:!0});var E=_(o);g=p(E,"Auto-spawning every ~3 seconds | Max: "),M=p(E,C),J=p(E," enemies"),E.forEach(x),z.forEach(x),this.h()},h(){e(a,"font-size","10px"),e(a,"color","#FF5722"),e(a,"font-weight","bold"),e(o,"font-size","8px"),e(o,"color","#aaa"),e(o,"margin-top","1px"),e(i,"padding","6px 8px"),e(i,"background","rgba(255, 87, 34, 0.2)"),e(i,"border-radius","4px"),e(i,"text-align","center"),e(i,"margin-bottom","8px")},m(j,z){Jn(j,i,z),t(i,a),t(i,F),t(i,o),t(o,g),t(o,M),t(o,J)},p:wn,d(j){j&&x(i)}}}function Si(n){let i,a,v,F,o,g,C,M,J,j,z,E,se,Te="🐉 Dragon Animation Test",ee,V,$,Fe="Animation Status",je,pe,ce=n[5]?"▶️ Playing":"⏸️ Paused",ue,at,Ne,He,Oe,ve,st,Ce,lt,U,be,At="Animation Speed",dt,le,re,qe,q,ct,Ee,kt="FPS",Ge,xe,Ue="1 FPS = Slow | 8 FPS = Default | 20 FPS = Fast",We,k,fe,K,ut,Ye,pt,Q,ft,Le,r,s,b="Wind Swept Nomads:",S,l,f,P,A,R,D,H,O,W,G,ht=n[5]?"⏸️ Pause All":"▶️ Play All",It,Tt,dr,Ae,Cn="Combat Controls:",cr,Se,Y,ur,pr,fr,jt,hr,L,mr,gr,vr,Vt,br,ye,En=`<div style="font-size:11px; color:#4CAF50; font-weight:bold;">🤖 Automatic Combat</div> <div style="font-size:9px; color:#aaa; margin-top:2px;">Dragons auto-attack enemies in range<br/>
          Enemies move toward dragons, then auto-attack</div>`,xr,X,mt=n[9]?"⏹️ Stop Game Simulation":"🎮 Start Game Simulation",zt,Rt,yr,$t,ke,ne,wr,Bt,_r,ie,Fr,Nt,Cr,de,Er,Ht,Sr,I,Ie,Sn="Statistics",Dr,Xe,Pr,gt=n[0].length+"",Ot,Mr,Je,Ar,vt=n[2].length+"",qt,kr,Ke,Ir,bt=n[3].length+"",Gt,Tr,Qe,jr,xt=n[0].length+n[2].length+n[3].length+"",Ut,Vr,De,zr,Rr,$r,Br,we,Nr,Dn=n[12]["mantair-corsair"]+"",Hr,Or,Pn=n[12].swarm+"",qr,Gr,Ur,_e,Wr,yt=n[10].currentColumn+1+"",Wt,Yr,wt=n[10].currentPosition+1+"",Yt,Lr,Pe,Xr,Mn="Automatic 🤖",Jr,Kr,_t=n[2].filter(Yn).length+"",Lt,Qr,Ve,Zr,Ft=n[2].length>0?`${Math.min(...n[2].map(Ln)).toFixed(1)}x - ${Math.max(...n[2].map(Xn)).toFixed(1)}x`:"none",Xt,en,ze,tn,Ct=n[9]?`Auto 🎮 (${n[2].length}/${n[13].maxEnemies})`:"Manual",Jt,rn,$e,Et=n[4]?"System ready ✓":"Loading...",Kt,nn,Re,Z,Ze,An="Animation Sequence:",on,an,sn,ln,et,kn="Frame Rate:",dn,Qt,cn,St=Math.round(1e3/n[6])+"",Zt,un,pn,In,oe=n[9]&&Wn(n);return{c(){i=d("div"),a=d("div"),v=y(),F=d("div"),o=y(),g=d("div"),C=y(),M=d("div"),J=y(),j=d("canvas"),z=y(),E=d("div"),se=d("h3"),se.textContent=Te,ee=y(),V=d("div"),$=d("div"),$.textContent=Fe,je=y(),pe=d("div"),ue=u(ce),at=u(" at "),Ne=u(n[6]),He=u(" FPS"),Oe=y(),ve=d("div"),st=u("Current Frame: "),Ce=u(n[11]),lt=y(),U=d("div"),be=d("div"),be.textContent=At,dt=y(),le=d("div"),re=d("input"),qe=y(),q=d("input"),ct=y(),Ee=d("span"),Ee.textContent=kt,Ge=y(),xe=d("div"),xe.textContent=Ue,We=y(),k=d("div"),fe=d("div"),K=d("button"),ut=u("🎯 Left Dragon"),pt=y(),Q=d("button"),ft=u("🎲 Random Dragon"),r=y(),s=d("div"),s.textContent=b,S=y(),l=d("div"),f=d("button"),P=u("⚔️ Mantair Corsair"),R=y(),D=d("button"),H=u("🐝 Swarm"),W=y(),G=d("button"),It=u(ht),dr=y(),Ae=d("div"),Ae.textContent=Cn,cr=y(),Se=d("div"),Y=d("button"),ur=u("📏 Dragon Range ("),pr=u(ot),fr=u("px)"),hr=y(),L=d("button"),mr=u("📏 Enemy Range ("),gr=u(Me),vr=u("px)"),br=y(),ye=d("div"),ye.innerHTML=En,xr=y(),X=d("button"),zt=u(mt),yr=y(),oe&&oe.c(),$t=y(),ke=d("div"),ne=d("button"),wr=u("🗑️ Clear Dragons"),_r=y(),ie=d("button"),Fr=u("🗑️ Clear Enemies"),Cr=y(),de=d("button"),Er=u("🗑️ Remove All"),Sr=y(),I=d("div"),Ie=d("div"),Ie.textContent=Sn,Dr=y(),Xe=d("div"),Pr=u("Dragons: "),Ot=u(gt),Mr=y(),Je=d("div"),Ar=u("Enemies: "),qt=u(vt),kr=y(),Ke=d("div"),Ir=u("Projectiles: "),Gt=u(bt),Tr=y(),Qe=d("div"),jr=u("Total Sprites: "),Ut=u(xt),Vr=y(),De=d("div"),zr=u("Dragon Damage: "),Rr=u(lr),$r=u(" per hit"),Br=y(),we=d("div"),Nr=u("Enemy Health: Mantair "),Hr=u(Dn),Or=u("HP | Swarm "),qr=u(Pn),Gr=u("HP"),Ur=y(),_e=d("div"),Wr=u("Formation: Column "),Wt=u(yt),Yr=u(", Position "),Yt=u(wt),Lr=y(),Pe=d("div"),Xr=u("Combat: "),Jr=u(Mn),Kr=u(" | Moving: "),Lt=u(_t),Qr=y(),Ve=d("div"),Zr=u("Speed Range: "),Xt=u(Ft),en=y(),ze=d("div"),tn=u("Spawning: "),Jt=u(Ct),rn=y(),$e=d("div"),Kt=u(Et),nn=y(),Re=d("div"),Z=d("div"),Ze=d("strong"),Ze.textContent=An,on=d("br"),an=u(`
        idle → fly_1 → fly_2 → fly_3 → repeat`),sn=d("br"),ln=y(),et=d("strong"),et.textContent=kn,dn=y(),Qt=u(n[6]),cn=u(" FPS ("),Zt=u(St),un=u("ms/frame)"),this.h()},l(h){i=c(h,"DIV",{style:!0});var m=_(i);a=c(m,"DIV",{style:!0}),_(a).forEach(x),v=w(m),F=c(m,"DIV",{style:!0}),_(F).forEach(x),o=w(m),g=c(m,"DIV",{style:!0}),_(g).forEach(x),C=w(m),M=c(m,"DIV",{style:!0}),_(M).forEach(x),J=w(m),j=c(m,"CANVAS",{style:!0}),_(j).forEach(x),z=w(m),E=c(m,"DIV",{style:!0});var he=_(E);se=c(he,"H3",{style:!0,"data-svelte-h":!0}),ge(se)!=="svelte-cvwswg"&&(se.textContent=Te),ee=w(he),V=c(he,"DIV",{style:!0});var tt=_(V);$=c(tt,"DIV",{style:!0,"data-svelte-h":!0}),ge($)!=="svelte-e93cyx"&&($.textContent=Fe),je=w(tt),pe=c(tt,"DIV",{style:!0});var Dt=_(pe);ue=p(Dt,ce),at=p(Dt," at "),Ne=p(Dt,n[6]),He=p(Dt," FPS"),Dt.forEach(x),Oe=w(tt),ve=c(tt,"DIV",{style:!0});var fn=_(ve);st=p(fn,"Current Frame: "),Ce=p(fn,n[11]),fn.forEach(x),tt.forEach(x),lt=w(he),U=c(he,"DIV",{style:!0});var rt=_(U);be=c(rt,"DIV",{style:!0,"data-svelte-h":!0}),ge(be)!=="svelte-1fnnw9i"&&(be.textContent=At),dt=w(rt),le=c(rt,"DIV",{style:!0});var nt=_(le);re=c(nt,"INPUT",{type:!0,min:!0,max:!0,step:!0,style:!0}),qe=w(nt),q=c(nt,"INPUT",{type:!0,min:!0,max:!0,style:!0}),ct=w(nt),Ee=c(nt,"SPAN",{style:!0,"data-svelte-h":!0}),ge(Ee)!=="svelte-17jk7z"&&(Ee.textContent=kt),nt.forEach(x),Ge=w(rt),xe=c(rt,"DIV",{style:!0,"data-svelte-h":!0}),ge(xe)!=="svelte-mfjj14"&&(xe.textContent=Ue),rt.forEach(x),We=w(he),k=c(he,"DIV",{style:!0});var N=_(k);fe=c(N,"DIV",{style:!0});var er=_(fe);K=c(er,"BUTTON",{style:!0});var Tn=_(K);ut=p(Tn,"🎯 Left Dragon"),Tn.forEach(x),pt=w(er),Q=c(er,"BUTTON",{style:!0});var jn=_(Q);ft=p(jn,"🎲 Random Dragon"),jn.forEach(x),er.forEach(x),r=w(N),s=c(N,"DIV",{style:!0,"data-svelte-h":!0}),ge(s)!=="svelte-uatgx1"&&(s.textContent=b),S=w(N),l=c(N,"DIV",{style:!0});var tr=_(l);f=c(tr,"BUTTON",{style:!0});var Vn=_(f);P=p(Vn,"⚔️ Mantair Corsair"),Vn.forEach(x),R=w(tr),D=c(tr,"BUTTON",{style:!0});var zn=_(D);H=p(zn,"🐝 Swarm"),zn.forEach(x),tr.forEach(x),W=w(N),G=c(N,"BUTTON",{style:!0});var Rn=_(G);It=p(Rn,ht),Rn.forEach(x),dr=w(N),Ae=c(N,"DIV",{style:!0,"data-svelte-h":!0}),ge(Ae)!=="svelte-8xjzya"&&(Ae.textContent=Cn),cr=w(N),Se=c(N,"DIV",{style:!0});var rr=_(Se);Y=c(rr,"BUTTON",{style:!0});var nr=_(Y);ur=p(nr,"📏 Dragon Range ("),pr=p(nr,ot),fr=p(nr,"px)"),nr.forEach(x),hr=w(rr),L=c(rr,"BUTTON",{style:!0});var ir=_(L);mr=p(ir,"📏 Enemy Range ("),gr=p(ir,Me),vr=p(ir,"px)"),ir.forEach(x),rr.forEach(x),br=w(N),ye=c(N,"DIV",{style:!0,"data-svelte-h":!0}),ge(ye)!=="svelte-qu2ov"&&(ye.innerHTML=En),xr=w(N),X=c(N,"BUTTON",{style:!0});var $n=_(X);zt=p($n,mt),$n.forEach(x),yr=w(N),oe&&oe.l(N),$t=w(N),ke=c(N,"DIV",{style:!0});var or=_(ke);ne=c(or,"BUTTON",{style:!0});var Bn=_(ne);wr=p(Bn,"🗑️ Clear Dragons"),Bn.forEach(x),_r=w(or),ie=c(or,"BUTTON",{style:!0});var Nn=_(ie);Fr=p(Nn,"🗑️ Clear Enemies"),Nn.forEach(x),or.forEach(x),Cr=w(N),de=c(N,"BUTTON",{style:!0});var Hn=_(de);Er=p(Hn,"🗑️ Remove All"),Hn.forEach(x),N.forEach(x),Sr=w(he),I=c(he,"DIV",{style:!0});var B=_(I);Ie=c(B,"DIV",{style:!0,"data-svelte-h":!0}),ge(Ie)!=="svelte-18bwzdk"&&(Ie.textContent=Sn),Dr=w(B),Xe=c(B,"DIV",{});var hn=_(Xe);Pr=p(hn,"Dragons: "),Ot=p(hn,gt),hn.forEach(x),Mr=w(B),Je=c(B,"DIV",{});var mn=_(Je);Ar=p(mn,"Enemies: "),qt=p(mn,vt),mn.forEach(x),kr=w(B),Ke=c(B,"DIV",{});var gn=_(Ke);Ir=p(gn,"Projectiles: "),Gt=p(gn,bt),gn.forEach(x),Tr=w(B),Qe=c(B,"DIV",{});var vn=_(Qe);jr=p(vn,"Total Sprites: "),Ut=p(vn,xt),vn.forEach(x),Vr=w(B),De=c(B,"DIV",{style:!0});var ar=_(De);zr=p(ar,"Dragon Damage: "),Rr=p(ar,lr),$r=p(ar," per hit"),ar.forEach(x),Br=w(B),we=c(B,"DIV",{style:!0});var it=_(we);Nr=p(it,"Enemy Health: Mantair "),Hr=p(it,Dn),Or=p(it,"HP | Swarm "),qr=p(it,Pn),Gr=p(it,"HP"),it.forEach(x),Ur=w(B),_e=c(B,"DIV",{style:!0});var Pt=_(_e);Wr=p(Pt,"Formation: Column "),Wt=p(Pt,yt),Yr=p(Pt,", Position "),Yt=p(Pt,wt),Pt.forEach(x),Lr=w(B),Pe=c(B,"DIV",{style:!0});var Mt=_(Pe);Xr=p(Mt,"Combat: "),Jr=p(Mt,Mn),Kr=p(Mt," | Moving: "),Lt=p(Mt,_t),Mt.forEach(x),Qr=w(B),Ve=c(B,"DIV",{style:!0});var bn=_(Ve);Zr=p(bn,"Speed Range: "),Xt=p(bn,Ft),bn.forEach(x),en=w(B),ze=c(B,"DIV",{style:!0});var xn=_(ze);tn=p(xn,"Spawning: "),Jt=p(xn,Ct),xn.forEach(x),rn=w(B),$e=c(B,"DIV",{style:!0});var On=_($e);Kt=p(On,Et),On.forEach(x),B.forEach(x),nn=w(he),Re=c(he,"DIV",{style:!0});var qn=_(Re);Z=c(qn,"DIV",{style:!0});var me=_(Z);Ze=c(me,"STRONG",{"data-svelte-h":!0}),ge(Ze)!=="svelte-ygi7gr"&&(Ze.textContent=An),on=c(me,"BR",{}),an=p(me,`
        idle → fly_1 → fly_2 → fly_3 → repeat`),sn=c(me,"BR",{}),ln=w(me),et=c(me,"STRONG",{"data-svelte-h":!0}),ge(et)!=="svelte-kliqwd"&&(et.textContent=kn),dn=w(me),Qt=p(me,n[6]),cn=p(me," FPS ("),Zt=p(me,St),un=p(me,"ms/frame)"),me.forEach(x),qn.forEach(x),he.forEach(x),m.forEach(x),this.h()},h(){e(a,"position","absolute"),e(a,"inset","0"),e(a,"background","radial-gradient(ellipse at 50% 45%, rgba(240, 248, 255, 0.3) 0%, /* Heat shimmer effect */ rgba(230, 243, 255, 0.2) 40%, /* Morning mist */ rgba(176, 224, 230, 0.1) 70%, /* Atmospheric blue */ transparent 100% )"),e(F,"position","absolute"),e(F,"inset","0"),e(F,"background","linear-gradient(to bottom, transparent 0%, transparent 40%, rgba(112, 128, 144, 0.15) 45%, /* Distant slate grey mountains */ rgba(100, 149, 237, 0.1) 50%, /* Cornflower blue atmospheric mountains */ transparent 55%, transparent 100% )"),e(g,"position","absolute"),e(g,"inset","0"),e(g,"background","linear-gradient(135deg, transparent 0%, rgba(154, 205, 50, 0.1) 25%, /* Yellow-green grass highlights */ transparent 50%, rgba(85, 107, 47, 0.05) 75%, /* Dark olive grass shadows */ transparent 100% )"),e(g,"background-size","200px 200px"),e(M,"position","absolute"),e(M,"inset","0"),e(M,"background","radial-gradient(circle at 30% 70%, rgba(245, 245, 220, 0.05) 0%, /* Seed drift particles */ transparent 30% ), radial-gradient(circle at 70% 60%, rgba(222, 184, 135, 0.03) 0%, /* Dust swirl */ transparent 40% )"),e(j,"width","100%"),e(j,"height","100%"),e(j,"display","block"),e(se,"margin","0 0 12px 0"),e(se,"font-size","16px"),e(se,"color","#4CAF50"),e($,"font-size","11px"),e($,"color","#aaa"),e($,"margin-bottom","4px"),e(pe,"color",n[5]?"#4CAF50":"#f44336"),e(ve,"font-size","10px"),e(ve,"color","#888"),e(ve,"margin-top","2px"),e(V,"margin-bottom","12px"),e(V,"padding","8px"),e(V,"background","rgba(255,255,255,.1)"),e(V,"border-radius","6px"),e(be,"font-size","11px"),e(be,"color","#aaa"),e(be,"margin-bottom","6px"),Be(re,"type","range"),Be(re,"min","1"),Be(re,"max","20"),Be(re,"step","1"),e(re,"flex","1"),e(re,"accent-color","#4CAF50"),Be(q,"type","number"),Be(q,"min","1"),Be(q,"max","20"),e(q,"width","50px"),e(q,"padding","2px 4px"),e(q,"background","#333"),e(q,"color","#fff"),e(q,"border","1px solid #555"),e(q,"border-radius","3px"),e(q,"font-size","10px"),e(Ee,"font-size","10px"),e(Ee,"color","#888"),e(le,"display","flex"),e(le,"align-items","center"),e(le,"gap","8px"),e(xe,"font-size","9px"),e(xe,"color","#666"),e(xe,"margin-top","4px"),e(U,"margin-bottom","12px"),e(U,"padding","8px"),e(U,"background","rgba(255,255,255,.1)"),e(U,"border-radius","6px"),K.disabled=Ye=!n[4],e(K,"flex","1"),e(K,"padding","8px 12px"),e(K,"background","#4CAF50"),e(K,"color","white"),e(K,"border","none"),e(K,"border-radius","6px"),e(K,"cursor","pointer"),e(K,"font-size","11px"),Q.disabled=Le=!n[4],e(Q,"flex","1"),e(Q,"padding","8px 12px"),e(Q,"background","#2196F3"),e(Q,"color","white"),e(Q,"border","none"),e(Q,"border-radius","6px"),e(Q,"cursor","pointer"),e(Q,"font-size","11px"),e(fe,"display","flex"),e(fe,"gap","6px"),e(s,"font-size","10px"),e(s,"color","#aaa"),e(s,"margin","4px 0"),f.disabled=A=!n[4],e(f,"flex","1"),e(f,"padding","8px 12px"),e(f,"background","#FF6B35"),e(f,"color","white"),e(f,"border","none"),e(f,"border-radius","6px"),e(f,"cursor","pointer"),e(f,"font-size","10px"),D.disabled=O=!n[4],e(D,"flex","1"),e(D,"padding","8px 12px"),e(D,"background","#8B4513"),e(D,"color","white"),e(D,"border","none"),e(D,"border-radius","6px"),e(D,"cursor","pointer"),e(D,"font-size","10px"),e(l,"display","flex"),e(l,"gap","6px"),G.disabled=Tt=!n[4]||n[0].length===0&&n[2].length===0,e(G,"padding","8px 12px"),e(G,"background",n[5]?"#FF9800":"#4CAF50"),e(G,"color","white"),e(G,"border","none"),e(G,"border-radius","6px"),e(G,"cursor","pointer"),e(G,"font-size","11px"),e(Ae,"font-size","10px"),e(Ae,"color","#aaa"),e(Ae,"margin","8px 0 4px 0"),Y.disabled=jt=!n[4]||n[0].length===0,e(Y,"flex","1"),e(Y,"padding","6px 8px"),e(Y,"background",n[7]?"#FF9800":"#607D8B"),e(Y,"color","white"),e(Y,"border","none"),e(Y,"border-radius","4px"),e(Y,"cursor","pointer"),e(Y,"font-size","9px"),L.disabled=Vt=!n[4]||n[2].length===0,e(L,"flex","1"),e(L,"padding","6px 8px"),e(L,"background",n[8]?"#FF5722":"#795548"),e(L,"color","white"),e(L,"border","none"),e(L,"border-radius","4px"),e(L,"cursor","pointer"),e(L,"font-size","9px"),e(Se,"display","flex"),e(Se,"gap","6px"),e(Se,"margin-bottom","6px"),e(ye,"padding","8px"),e(ye,"background","rgba(76, 175, 80, 0.2)"),e(ye,"border-radius","6px"),e(ye,"text-align","center"),e(ye,"margin-bottom","8px"),X.disabled=Rt=!n[4]||n[0].length===0,e(X,"width","100%"),e(X,"padding","12px"),e(X,"background",n[9]?"#FF5722":"#2196F3"),e(X,"color","white"),e(X,"border","none"),e(X,"border-radius","8px"),e(X,"cursor","pointer"),e(X,"font-size","12px"),e(X,"font-weight","bold"),e(X,"margin-bottom","12px"),ne.disabled=Bt=n[0].length===0,e(ne,"flex","1"),e(ne,"padding","6px 8px"),e(ne,"background","#f44336"),e(ne,"color","white"),e(ne,"border","none"),e(ne,"border-radius","4px"),e(ne,"cursor","pointer"),e(ne,"font-size","10px"),ie.disabled=Nt=n[2].length===0,e(ie,"flex","1"),e(ie,"padding","6px 8px"),e(ie,"background","#f44336"),e(ie,"color","white"),e(ie,"border","none"),e(ie,"border-radius","4px"),e(ie,"cursor","pointer"),e(ie,"font-size","10px"),e(ke,"display","flex"),e(ke,"gap","6px"),de.disabled=Ht=n[0].length===0&&n[2].length===0,e(de,"padding","8px 12px"),e(de,"background","#d32f2f"),e(de,"color","white"),e(de,"border","none"),e(de,"border-radius","6px"),e(de,"cursor","pointer"),e(de,"font-size","11px"),e(k,"display","flex"),e(k,"flex-direction","column"),e(k,"gap","8px"),e(Ie,"font-size","11px"),e(Ie,"color","#aaa"),e(Ie,"margin-bottom","6px"),e(De,"font-size","10px"),e(De,"color","#888"),e(De,"margin-top","4px"),e(we,"font-size","10px"),e(we,"color","#888"),e(_e,"font-size","10px"),e(_e,"color","#888"),e(_e,"margin-top","4px"),e(Pe,"font-size","10px"),e(Pe,"color","#888"),e(Ve,"font-size","10px"),e(Ve,"color","#888"),e(ze,"font-size","10px"),e(ze,"color","#888"),e($e,"font-size","10px"),e($e,"color","#888"),e(I,"border-top","1px solid #444"),e(I,"padding-top","12px"),e(I,"margin-top","12px"),e(Z,"font-size","10px"),e(Z,"color","#888"),e(Z,"line-height","1.4"),e(Re,"border-top","1px solid #444"),e(Re,"padding-top","12px"),e(Re,"margin-top","12px"),e(E,"position","absolute"),e(E,"right","8px"),e(E,"top","8px"),e(E,"background","rgba(0,0,0,.9)"),e(E,"color","#fff"),e(E,"padding","16px"),e(E,"border-radius","12px"),e(E,"font","12px system-ui"),e(E,"min-width","280px"),e(E,"max-width","320px"),e(E,"backdrop-filter","blur(10px)"),e(E,"overflow-wrap","break-word"),e(i,"position","fixed"),e(i,"inset","0"),e(i,"background","linear-gradient(to bottom, /* Sky layers with authentic steppe blues */ #4169E1 0%, /* Deep sky blue */ #87CEEB 15%, /* Main sky blue from images */ #B0E0E6 30%, /* Powder blue for atmosphere */ #E6F3FF 45%, /* Morning haze near horizon */ /* Grass layers with extracted steppe greens */ #6B8E23 60%, /* Primary olive drab grass */ #228B22 75%, /* Rich forest green grass */ #9ACD32 85%, /* Yellow-green sunlit grass */ #556B2F 100% /* Dark olive green shadows */ )")},m(h,m){Jn(h,i,m),t(i,a),t(i,v),t(i,F),t(i,o),t(i,g),t(i,C),t(i,M),t(i,J),t(i,j),n[26](j),t(i,z),t(i,E),t(E,se),t(E,ee),t(E,V),t(V,$),t(V,je),t(V,pe),t(pe,ue),t(pe,at),t(pe,Ne),t(pe,He),t(V,Oe),t(V,ve),t(ve,st),t(ve,Ce),t(E,lt),t(E,U),t(U,be),t(U,dt),t(U,le),t(le,re),sr(re,n[6]),t(le,qe),t(le,q),sr(q,n[6]),t(le,ct),t(le,Ee),t(U,Ge),t(U,xe),t(E,We),t(E,k),t(k,fe),t(fe,K),t(K,ut),t(fe,pt),t(fe,Q),t(Q,ft),t(k,r),t(k,s),t(k,S),t(k,l),t(l,f),t(f,P),t(l,R),t(l,D),t(D,H),t(k,W),t(k,G),t(G,It),t(k,dr),t(k,Ae),t(k,cr),t(k,Se),t(Se,Y),t(Y,ur),t(Y,pr),t(Y,fr),t(Se,hr),t(Se,L),t(L,mr),t(L,gr),t(L,vr),t(k,br),t(k,ye),t(k,xr),t(k,X),t(X,zt),t(k,yr),oe&&oe.m(k,null),t(k,$t),t(k,ke),t(ke,ne),t(ne,wr),t(ke,_r),t(ke,ie),t(ie,Fr),t(k,Cr),t(k,de),t(de,Er),t(E,Sr),t(E,I),t(I,Ie),t(I,Dr),t(I,Xe),t(Xe,Pr),t(Xe,Ot),t(I,Mr),t(I,Je),t(Je,Ar),t(Je,qt),t(I,kr),t(I,Ke),t(Ke,Ir),t(Ke,Gt),t(I,Tr),t(I,Qe),t(Qe,jr),t(Qe,Ut),t(I,Vr),t(I,De),t(De,zr),t(De,Rr),t(De,$r),t(I,Br),t(I,we),t(we,Nr),t(we,Hr),t(we,Or),t(we,qr),t(we,Gr),t(I,Ur),t(I,_e),t(_e,Wr),t(_e,Wt),t(_e,Yr),t(_e,Yt),t(I,Lr),t(I,Pe),t(Pe,Xr),t(Pe,Jr),t(Pe,Kr),t(Pe,Lt),t(I,Qr),t(I,Ve),t(Ve,Zr),t(Ve,Xt),t(I,en),t(I,ze),t(ze,tn),t(ze,Jt),t(I,rn),t(I,$e),t($e,Kt),t(E,nn),t(E,Re),t(Re,Z),t(Z,Ze),t(Z,on),t(Z,an),t(Z,sn),t(Z,ln),t(Z,et),t(Z,dn),t(Z,Qt),t(Z,cn),t(Z,Zt),t(Z,un),pn||(In=[ae(re,"change",n[27]),ae(re,"input",n[27]),ae(re,"input",n[28]),ae(q,"input",n[29]),ae(q,"input",n[30]),ae(K,"click",n[23]),ae(Q,"click",n[14]),ae(f,"click",n[24]),ae(D,"click",n[25]),ae(G,"click",n[15]),ae(Y,"click",n[19]),ae(L,"click",n[20]),ae(X,"click",n[21]),ae(ne,"click",n[16]),ae(ie,"click",n[17]),ae(de,"click",n[18])],pn=!0)},p(h,m){m[0]&32&&ce!==(ce=h[5]?"▶️ Playing":"⏸️ Paused")&&te(ue,ce),m[0]&64&&te(Ne,h[6]),m[0]&32&&e(pe,"color",h[5]?"#4CAF50":"#f44336"),m[0]&2048&&te(Ce,h[11]),m[0]&64&&sr(re,h[6]),m[0]&64&&_n(q.value)!==h[6]&&sr(q,h[6]),m[0]&16&&Ye!==(Ye=!h[4])&&(K.disabled=Ye),m[0]&16&&Le!==(Le=!h[4])&&(Q.disabled=Le),m[0]&16&&A!==(A=!h[4])&&(f.disabled=A),m[0]&16&&O!==(O=!h[4])&&(D.disabled=O),m[0]&32&&ht!==(ht=h[5]?"⏸️ Pause All":"▶️ Play All")&&te(It,ht),m[0]&21&&Tt!==(Tt=!h[4]||h[0].length===0&&h[2].length===0)&&(G.disabled=Tt),m[0]&32&&e(G,"background",h[5]?"#FF9800":"#4CAF50"),m[0]&17&&jt!==(jt=!h[4]||h[0].length===0)&&(Y.disabled=jt),m[0]&128&&e(Y,"background",h[7]?"#FF9800":"#607D8B"),m[0]&20&&Vt!==(Vt=!h[4]||h[2].length===0)&&(L.disabled=Vt),m[0]&256&&e(L,"background",h[8]?"#FF5722":"#795548"),m[0]&512&&mt!==(mt=h[9]?"⏹️ Stop Game Simulation":"🎮 Start Game Simulation")&&te(zt,mt),m[0]&17&&Rt!==(Rt=!h[4]||h[0].length===0)&&(X.disabled=Rt),m[0]&512&&e(X,"background",h[9]?"#FF5722":"#2196F3"),h[9]?oe?oe.p(h,m):(oe=Wn(h),oe.c(),oe.m(k,$t)):oe&&(oe.d(1),oe=null),m[0]&1&&Bt!==(Bt=h[0].length===0)&&(ne.disabled=Bt),m[0]&4&&Nt!==(Nt=h[2].length===0)&&(ie.disabled=Nt),m[0]&5&&Ht!==(Ht=h[0].length===0&&h[2].length===0)&&(de.disabled=Ht),m[0]&1&&gt!==(gt=h[0].length+"")&&te(Ot,gt),m[0]&4&&vt!==(vt=h[2].length+"")&&te(qt,vt),m[0]&8&&bt!==(bt=h[3].length+"")&&te(Gt,bt),m[0]&13&&xt!==(xt=h[0].length+h[2].length+h[3].length+"")&&te(Ut,xt),m[0]&1024&&yt!==(yt=h[10].currentColumn+1+"")&&te(Wt,yt),m[0]&1024&&wt!==(wt=h[10].currentPosition+1+"")&&te(Yt,wt),m[0]&4&&_t!==(_t=h[2].filter(Yn).length+"")&&te(Lt,_t),m[0]&4&&Ft!==(Ft=h[2].length>0?`${Math.min(...h[2].map(Ln)).toFixed(1)}x - ${Math.max(...h[2].map(Xn)).toFixed(1)}x`:"none")&&te(Xt,Ft),m[0]&516&&Ct!==(Ct=h[9]?`Auto 🎮 (${h[2].length}/${h[13].maxEnemies})`:"Manual")&&te(Jt,Ct),m[0]&16&&Et!==(Et=h[4]?"System ready ✓":"Loading...")&&te(Kt,Et),m[0]&64&&te(Qt,h[6]),m[0]&64&&St!==(St=Math.round(1e3/h[6])+"")&&te(Zt,St)},i:wn,o:wn,d(h){h&&x(i),n[26](null),oe&&oe.d(),pn=!1,ai(In)}}}const ot=400,Me=300,Di=50,lr=5,Yn=n=>n.isMoving,Ln=n=>n.currentSpeedMultiplier,Xn=n=>n.currentSpeedMultiplier;function Pi(n,i,a){let v,F,o,g=[],C=[],M=[],J=!1,j=!0,z=8,E=[],se=!1,Te=!1,ee=null,V=null,$=null,Fe=!1,je=null;const pe={"mantair-corsair":12,swarm:3},ce={baseInterval:3e3,intervalVariation:1e3,enemyTypes:["mantair-corsair","swarm"],maxEnemies:8};let ue={currentColumn:0,currentPosition:0,enemiesPerColumn:0,maxEnemiesPerColumn:8,columnSpacing:120,verticalSpacing:100,startX:600};async function at(){if(!(!o||!J))try{const{sprite:r,animator:s}=await Gn(o.renderer,o.stage),b=64,S=b+Math.random()*(o.renderer.width-b*2),l=b+Math.random()*(o.renderer.height-b*2);r.position.set(S,l),r.scale.set(.75),r.visible=!0,r.alpha=1,r.tint=16777215,console.log("Adding animated dragon to stage:",{position:r.position,visible:r.visible,stageChildren:o.stage.children.length,spriteTexture:r.texture,textureValid:r.texture?.source?.valid,rendererSize:{width:o.renderer.width,height:o.renderer.height}}),o.stage.addChild(r),o.renderer.render(o.stage),console.log("After adding sprite:",{stageChildren:o.stage.children.length,spriteInStage:o.stage.children.includes(r),spriteWorldTransform:r.worldTransform});const f={sprite:r,animator:s,x:S,y:l,lastFireTime:0,fireRate:1500+Math.random()*300};g.push(f),s.setFPS(z),j&&await s.start(),console.log("Animated dragon spawned successfully, total:",g.length),a(0,g),Ce()}catch(r){console.error("Failed to spawn animated dragon:",r)}}async function Ne(){a(5,j=!j);for(const r of g)j?await r.animator.start():r.animator.pause();for(const r of C)j?await r.animator.start():r.animator.pause()}function He(){for(const r of g)r.animator.destroy(),o.stage.removeChild(r.sprite);a(0,g=[]),Ce()}function Oe(){qe();for(const r of C)r.animator.destroy(),o.stage.removeChild(r.sprite);a(2,C=[]),a(10,ue.currentColumn=0,ue),a(10,ue.currentPosition=0,ue),a(10,ue.enemiesPerColumn=0,ue),U(),le(),console.log("Enemy formation reset")}function ve(){He(),Oe(),st()}function st(){for(const r of M)r.destroy();a(3,M=[])}function Ce(){if(!o||!se||g.length===0){ee&&(ee.visible=!1);return}ee||(ee=new yn,o.stage.addChild(ee)),ee.clear(),g.forEach(r=>{ee&&(ee.circle(r.x,r.y,ot).stroke({width:2,color:0,alpha:.8}),ee.moveTo(r.x,r.y).lineTo(r.x+ot,r.y).stroke({width:1,color:0,alpha:.6}))}),ee.visible=!0,o.renderer.render(o.stage)}function lt(){a(7,se=!se),Ce(),console.log(`Dragon attack range indicator: ${se?"ON":"OFF"}`)}function U(){if(!o||!Te||C.length===0){V&&(V.visible=!1);return}V||(V=new yn,o.stage.addChild(V)),V.clear(),C.forEach(r=>{if(V&&(V.circle(r.x,r.y,Me).stroke({width:2,color:16711680,alpha:.6}),g.length>0)){const s=g[0],b=s.x-r.x,S=s.y-r.y,l=Math.sqrt(b*b+S*S);if(l>0){const f=r.x+b/l*Me,P=r.y+S/l*Me;V.moveTo(r.x,r.y).lineTo(f,P).stroke({width:1,color:16711680,alpha:.4})}}}),V.visible=!0,o.renderer.render(o.stage)}function be(){a(8,Te=!Te),U(),console.log(`Enemy attack range indicator: ${Te?"ON":"OFF"}`)}function At(r){if(!r||!r.sprite)return;const s=r.sprite.tint,b=r.sprite.scale.x;r.sprite.tint=16724787,r.sprite.scale.set(b*1.1),o&&o.renderer.render(o.stage),setTimeout(()=>{r.sprite&&(r.sprite.tint=s,r.sprite.scale.set(b),o&&o.renderer.render(o.stage))},120),console.log(`${r.type} flashed red from damage (${r.health}/${r.maxHealth} HP remaining)`)}function dt(r){if(!r||!r.sprite)return;const s=r.sprite.tint,b=r.sprite.scale.x;r.sprite.tint=16737894,r.sprite.scale.set(b*1.08),o&&o.renderer.render(o.stage),setTimeout(()=>{r.sprite&&(r.sprite.tint=s,r.sprite.scale.set(b),o&&o.renderer.render(o.stage))},100),console.log("Dragon flashed red from enemy damage")}function le(){if(!o||C.length===0){$&&($.visible=!1);return}$||($=new yn,o.stage.addChild($)),$.clear(),C.forEach(r=>{if(!$)return;const s=40,b=6,S=r.x-s/2,l=r.y-40,f=Math.max(0,r.health/r.maxHealth);if($.rect(S,l,s,b).fill({color:16711680,alpha:.8}),f>0){let P=65280;f<.5&&(P=16776960),f<.25&&(P=16729344);const A=s*f;$.rect(S,l,A,b).fill({color:P,alpha:.9})}$.rect(S,l,s,b).stroke({width:1,color:0,alpha:.8})}),$.visible=!0,o.renderer.render(o.stage)}async function re(r){if(!o||r>=C.length||g.length===0)return;const s=C[r];if(!s){console.warn("Invalid enemy for projectile firing");return}const b=g.filter(f=>{const P=f.x-s.x,A=f.y-s.y;return Math.sqrt(P*P+A*A)<=Me});if(b.length===0){console.log(`${s.type} has no dragons in range (${Me}px) - not firing`);return}let S=b[0],l=1/0;b.forEach(f=>{const P=f.x-s.x,A=f.y-s.y,R=Math.sqrt(P*P+A*A);R<l&&(l=R,S=f)});try{const f=Ci(s.type),P=R=>{for(let D=0;D<g.length;D++){const H=g[D],O=R.getBounds(),W=H.sprite.getBounds();if(O.x<W.x+W.width&&O.x+O.width>W.x&&O.y<W.y+W.height&&O.y+O.height>W.y)return console.log("Enemy projectile hit dragon!"),dt(H),!0}return!1},A=await Un(f,s.x,s.y,S.x,S.y,o.renderer,o.stage,P);A.setFPS(z),M.push(A),console.log(`${s.type} fired projectile toward dragon (distance: ${Math.round(l)}px)`),a(3,M)}catch(f){console.error(`Failed to fire projectile from ${s.type}:`,f)}}function qe(){E.forEach(r=>clearInterval(r)),E=[],console.log("All enemies stop shooting - intervals cleared")}async function q(r){if(!o||r>=g.length||C.length===0)return;const s=g[r],b=C.filter(f=>{const P=f.x-s.x,A=f.y-s.y;return Math.sqrt(P*P+A*A)<=ot});if(b.length===0)return;let S=b[0],l=1/0;b.forEach(f=>{const P=f.x-s.x,A=f.y-s.y,R=Math.sqrt(P*P+A*A);R<l&&(l=R,S=f)});try{const f=Ei(),P=R=>{for(let D=0;D<C.length;D++){const H=C[D],O=R.getBounds(),W=H.sprite.getBounds();if(O.x<W.x+W.width&&O.x+O.width>W.x&&O.y<W.y+W.height&&O.y+O.height>W.y)return H.health-=lr,console.log(`Dragon projectile hit ${H.type} for ${lr} damage! Health: ${H.health}/${H.maxHealth}`),At(H),H.health<=0&&(console.log(`${H.type} defeated!`),H.animator.destroy(),o.stage.removeChild(H.sprite),C.splice(D,1),U(),a(2,C)),!0}return!1},A=await Un(f,s.x,s.y,S.x,S.y,o.renderer,o.stage,P);A.setFPS(z),M.push(A),console.log(`Dragon fired projectile toward ${S.type}`),a(3,M)}catch(f){console.error("Failed to fire projectile from dragon:",f)}}function ct(){let r=performance.now();function s(){if(!o)return;const b=performance.now(),S=b-r;r=b;const l=[];for(const f of M)f.update(S)?l.push(f):console.log("Projectile hit target and destroyed");l.length!==M.length&&a(3,M=l),requestAnimationFrame(s)}requestAnimationFrame(s),console.log("Projectile update loop started")}function Ee(){let r=performance.now();function s(){if(!o)return;const b=performance.now(),S=b-r;r=b,C.forEach((l,f)=>{if(!g.length)return;const P=g[0],A=P.x-l.x,R=P.y-l.y,D=Math.sqrt(A*A+R*R);if(l.isMoving&&D>Me){const H=l.animator.getCurrentSpeedMultiplier(),O=Di*H*(S/1e3);if(D>0){const W=A/D*O,G=R/D*O;l.x+=W,l.y+=G,l.sprite.position.set(l.x,l.y),l.currentSpeedMultiplier=H}}else D<=Me?(l.isMoving=!1,l.type==="mantair-corsair"&&l.animator.getCurrentFrame()!=="fly_3"&&l.animator.forceFrame("fly_3",!0),b-l.lastFireTime>=l.fireRate&&(re(f),l.lastFireTime=b)):D>Me*1.2&&(l.isMoving=!0,l.type==="mantair-corsair"&&l.animator.forceFrame("fly_3",!1))}),g.forEach((l,f)=>{C.filter(A=>{const R=A.x-l.x,D=A.y-l.y;return Math.sqrt(R*R+D*D)<=ot}).length>0&&b-l.lastFireTime>=l.fireRate&&(q(f),l.lastFireTime=b)}),Ce(),U(),le(),requestAnimationFrame(s)}requestAnimationFrame(s),console.log("Enemy movement and combat loop started")}function kt(){if(Fe||!J)return;a(9,Fe=!0),console.log("Auto-spawning started - simulating gameplay!");const r=()=>{if(!Fe)return;const s=ce.baseInterval,b=(Math.random()-.5)*ce.intervalVariation,S=s+b;je=window.setTimeout(()=>{if(Fe){if(C.length<ce.maxEnemies){const l=ce.enemyTypes[Math.floor(Math.random()*ce.enemyTypes.length)];fe(l),console.log(`Auto-spawned ${l} (${C.length+1}/${ce.maxEnemies})`)}else console.log(`Max enemies reached (${ce.maxEnemies}) - waiting for some to be defeated`);r()}},S)};r()}function Ge(){a(9,Fe=!1),je&&(clearTimeout(je),je=null),console.log("Auto-spawning stopped")}function xe(){Fe?Ge():kt()}function Ue(r){a(6,z=r),console.log(`Changing all animations to ${r} FPS`);for(const s of g)s.animator.setFPS(r);for(const s of C)s.animator.setFPS(r);for(const s of M)s.setFPS(r)}function We(){!o||!J||Gn(o.renderer,o.stage).then(({sprite:r,animator:s})=>{const S=o.renderer.height/2;r.position.set(150,S),r.scale.set(1),r.visible=!0,console.log("Adding left-side dragon to stage:",{position:r.position,visible:r.visible,stageChildren:o.stage.children.length}),o.stage.addChild(r),o.renderer.render(o.stage);const l={sprite:r,animator:s,x:150,y:S,lastFireTime:0,fireRate:1500+Math.random()*300};g.push(l),s.setFPS(z),j&&s.start(),console.log("Left-side dragon spawned successfully, total:",g.length),a(0,g),Ce()}).catch(r=>{console.error("Failed to spawn left-side dragon:",r)})}function k(){const r=o.renderer.width-320,s=50,b=s+Math.random()*(o.renderer.height-s*2);return{x:r,y:b}}async function fe(r){if(!(!o||!J))try{const{sprite:s,animator:b}=await yi(r,o.renderer,o.stage),{x:S,y:l}=k();s.position.set(S,l),s.scale.set(.75),s.visible=!0,s.alpha=1,s.tint=16777215,console.log(`Adding ${r} to formation:`,{position:s.position,column:ue.currentColumn+1,positionInColumn:ue.currentPosition+1,visible:s.visible}),o.stage.addChild(s),o.renderer.render(o.stage);const f=pe[r]||10,P={sprite:s,animator:b,x:S,y:l,type:r,isMoving:!0,lastFireTime:0,fireRate:2e3+Math.random()*500,health:f,maxHealth:f,currentSpeedMultiplier:1,lastFrameChangeTime:performance.now()};C.push(P),b.setFrameChangeCallback((A,R)=>{P.currentSpeedMultiplier=R,P.lastFrameChangeTime=performance.now(),console.log(`${r} movement speed updated: ${R.toFixed(2)}x (frame: ${A})`)}),b.setFPS(z),j&&await b.start(),console.log(`${r} spawned in formation, total enemies:`,C.length),a(2,C),U()}catch(s){console.error(`Failed to spawn ${r}:`,s)}}function K(){fe("mantair-corsair")}function ut(){fe("swarm")}si(async()=>{try{console.log("Creating PixiJS app with explicit settings..."),o=new pi,await o.init({canvas:F,backgroundAlpha:0,antialias:!1,resolution:1,autoDensity:!0,width:F.clientWidth||800,height:F.clientHeight||600}),o.ticker&&(o.ticker.stop(),console.log("Ticker stopped to avoid conflicts")),console.log("PixiJS app initialized:",{renderer:{width:o.renderer.width,height:o.renderer.height,type:o.renderer.type},stage:o.stage,canvas:o.canvas}),a(4,J=!0),ct(),Ee(),console.log("Attempting to spawn dragon..."),await We(),console.log("Dragon spawn completed")}catch(r){console.error("Failed to initialize PIXI app:",r),r instanceof Error&&console.error("Error details:",{message:r.message,stack:r.stack,name:r.name})}}),li(()=>{qe();for(const r of g)r.animator.destroy();a(0,g=[]);for(const r of C)r.animator.destroy();a(2,C=[]);for(const r of M)r.destroy();a(3,M=[]),E.forEach(r=>clearInterval(r)),E=[],ee&&(ee.destroy(),ee=null),V&&(V.destroy(),V=null),$&&($.destroy(),$=null),Ge(),o&&o.destroy(!0,{children:!0})});function Ye(r){di[r?"unshift":"push"](()=>{F=r,a(1,F)})}function pt(){z=_n(this.value),a(6,z)}const Q=()=>Ue(z);function ft(){z=_n(this.value),a(6,z)}const Le=()=>Ue(z);return n.$$.update=()=>{n.$$.dirty[0]&1&&a(11,v=g.length>0?g[0]?.animator.getCurrentFrame():"none")},[g,F,C,M,J,j,z,se,Te,Fe,ue,v,pe,ce,at,Ne,He,Oe,ve,lt,be,xe,Ue,We,K,ut,Ye,pt,Q,ft,Le]}class zi extends ci{constructor(i){super(),ui(this,i,Pi,Si,oi,{},null,[-1,-1])}}export{zi as component};

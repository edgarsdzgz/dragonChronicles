#!/usr/bin/env sh
set -eu

# Only run from repo root
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# Sync lockfile if any package.json changed in the commit
if git diff --cached --name-only | grep -E '(^|/)package\.json$' >/dev/null; then
  echo "package.json changed -> syncing pnpm-lock.yaml"
  pnpm -w install --lockfile-only
  git add pnpm-lock.yaml
fi

pnpm exec lint-staged